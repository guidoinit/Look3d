/*!CK:2233853079!*//*1383652466,178158909*/

if (self.CavalryLogger) { CavalryLogger.start_js(["2l8nf"]); }

__d("SystemEvents",["Arbiter","Env","ErrorUtils","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('ErrorUtils'),j=b('UserAgent'),k=b('copyProperties'),l=new g(),m=[],n=1000;setInterval(function(){for(var w=0;w<m.length;w++)m[w]();},n,false);function o(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var p=h.user,q=navigator.onLine;function r(){if(!q){q=true;l.inform(l.ONLINE,q);}}function s(){if(q){q=false;l.inform(l.ONLINE,q);}}if(j.ie()){if(j.ie()>=11){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}else if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=r;document.body.onoffline=s;});}else m.push(function(){(navigator.onLine?r:s)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}var t=p;m.push(function(){var w=o();if(t!=w){l.inform(l.USER,w);t=w;}});var u=Date.now();function v(){var w=Date.now(),x=w-u,y=x<0||x>10000;u=w;if(y)l.inform(l.TIME_TRAVEL,x);return y;}m.push(v);m.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});k(l,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(w){return (w||o())==p;},isOnline:function(){return j.chrome()||q;},checkTimeTravel:v});e.exports=l;});
__d("ChannelSubdomain",["Cookie","JSLogger"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('JSLogger'),i=h.create('channel'),j=7,k=null;function l(o,p){var q=null,r=m(),s;o--;var t=Math.min(32,j*o);t=Math.max(t,1);var u=false;for(var v=0;v<32;v++){s=(v+p)%t;if(!(r&(1<<s))){u=true;break;}}if(u){k=s;q=k%j;g.set('sub',r|(1<<k));}else{k=-1;q=null;i.error('subdomain_overflow',{slot:k,max:o});}return q;}function m(){var o=g.get('sub')||0;o=parseInt(o,10);return isNaN(o)?0:o;}function n(){if(k!==null&&k>=0){var o=m()&~(1<<k);if(o){g.set('sub',o);}else g.clear('sub');}}e.exports={allocate:l,clear:n};});
__d("ChannelTransport",["copyProperties","bind","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants","UserAgent","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('bind'),i=b('AjaxRequest'),j=b('URI'),k=b('JSLogger'),l=b('DocRPC'),m=b('ChannelConstants'),n=b('UserAgent'),o=b('setTimeoutAcrossTransitions'),p=k.create('channel');function q(){return (1048576*Math.random()|0).toString(36);}function r(z,aa){var ba=z.subdomain;ba=ba===null?'':(ba+'-');var ca=new j(aa).setDomain(ba+z.host+'.facebook.com').setPort(z.port).setSecure(j().isSecure());return ca;}function s(z){var aa={partition:z.partition,cb:q()},ba=r(z,'/p').setQueryData(aa);p.log('start_p',{uri:ba.toString()});var ca=new i('GET',ba);if(i.supportsCORS())ca.xhr.withCredentials=true;var da=function(ea){p.log('finish_p',{xhr:ea.toJSON?ea.toJSON():ea});};ca.timeout=z.P_TIMEOUT;ca.onError=ca.onSuccess=da;ca.send();}function t(z,aa,ba){var ca=new Image(),da=0,ea=function(ha){ca.abort();return ha?aa():ba();};ca.onload=function(){p.log('ping_ok',{duration:Date.now()-da});ea(true);};ca.onerror=function(){s(z);ea(false);};var fa=o(ca.onerror,10000);ca.abort=function(){if(fa){clearTimeout(fa);fa=null;}ca.onload=ca.onerror=null;};var ga={partition:z.partition,cb:q()};da=Date.now();ca.src=r(z,'/ping').setQueryData(ga);return ca;}function u(z,aa,ba,ca){var da=new Date(),ea=-1;if(z.userActive>0){ea=(da-z.userActive)/1000|0;if(ea<0)p.warn('idle_regression',{idleTime:ea,now:da.getTime(),userActive:z.userActive});}var fa={channel:z.user_channel,seq:z.seq,partition:z.partition,clientid:z.sessionID,cb:q(),idle:ea,cap:0};if(z.userActive>0&&ea<60)fa.state='active';if(z.streamingCapable){fa.mode='stream';fa.format='json';}if(z.profile)fa.profile=z.profile;if(z.webrtcSupport&&(n.chrome()>=24||n.firefox()>=22))fa.cap=m.CAPABILITY_VOIP;var ga=r(z,'/pull').setQueryData(fa),ha=new i('GET',ga);if(i.supportsCORS())ha.xhr.withCredentials=true;ha.timeout=z.streamingCapable?z.STREAMING_TIMEOUT:z.LONGPOLL_TIMEOUT;ha.onJSON=aa;ha.onSuccess=ba;ha.onError=function(){var ia=(this.status==12002&&this._time>=z.MIN_12002_TIMEOUT)||(this.status==504&&this._time>=z.MIN_504_TIMEOUT),ja=ia?ba:ca;return ja&&ja.apply(this,arguments);};ha.send();z.inStreaming=z.streamingCapable;return ha;}function v(z){this.manager=z;(this.init&&this.init());}function w(z){v.apply(this,arguments);}g(w.prototype,{logName:'CORS',enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='init')o(h(this.manager,'exitState',{status:m.OK,stateId:aa.stateId}),3000);if(!/pull|ping/.test(z))return;var ba=this.manager;if(z=='ping'){this._request=t(aa,h(ba,'exitState',{status:m.OK,stateId:aa.stateId}),h(ba,'exitState',{status:m.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,h(ba,'_processTransportData',aa.stateId),h(ba,'exitState',{status:m.OK,stateId:aa.stateId}),h(ba,'exitState',{status:m.ERROR,stateId:aa.stateId}));}});function x(z){p.log('iframe_init_constructor');v.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);l.publish(this,'outerTransport');}g(x.prototype,{logName:'iframe',_initIframe:function(z){p.log('iframe_init_start');window.onchanneliframeready=function(){p.log('iframe_resources');return z.resources;};window.onchanneliframeloaded=function(){p.log('iframe_loaded');};if(z){this._iframeURI=r(z,z.path);if(z.bustIframe){var aa={partition:z.partition,cb:q()};this._iframeURI.setQueryData(aa);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);p.log('iframe_uri_set');}catch(ba){p.error('iframe_uri_set_error',ba);this.exitState({status:m.ERROR,stateId:z.stateId},ba+'');}},enterState:function(z,aa){if(z=='init'){this._initIframe(aa);}else if(/idle|ping|pull/.test(z)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(z!='idle')this.exitState({status:m.ERROR,stateId:aa.stateId},'iframe not yet loaded');}else if(z=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(z){if(this.manager.state=='init'&&z.status==m.OK)this._iframeProxy=l.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function y(){this.init=this.init.bind(this);v.apply(this,arguments);}g(y.prototype,{logName:'iframe(inner)',init:function(){l.publish(this,'innerTransport');try{var aa=l.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);g(this,aa);this.exitState({status:m.OK,stateId:1e+06});}catch(z){p.error('iframe_inner_init_error',z);}},enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='ping'){this._request=t(aa,h(this,'exitState',{status:m.OK,stateId:aa.stateId}),h(this,'exitState',{status:m.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,h(this,'_processTransportData',aa.stateId),h(this,'exitState',{status:m.OK,stateId:aa.stateId}),h(this,'exitState',{status:m.ERROR,stateId:aa.stateId}));}});e.exports={getURI:r,Transport:v,CORSTransport:w,IframeTransport:x,IframeInnerTransport:y};});
__d("PresencePrivacy",["Arbiter","AsyncRequest","ChannelConstants","copyProperties","Env","JSLogger","PresenceUtil","PresencePrivacyInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ChannelConstants'),j=b('copyProperties'),k=b('Env'),l=b('JSLogger'),m=b('PresenceUtil'),n=b('PresencePrivacyInitialData'),o='/ajax/chat/privacy/settings.php',p='/ajax/chat/privacy/online_policy.php',q='/ajax/chat/privacy/visibility.php',r='friend_visibility',s='visibility',t='online_policy',u=j({},n.privacyData),v=n.visibility,w=j({},n.privacyData),x=v,y=n.onlinePolicy,z=y,aa=[],ba=false;function ca(){return l.create('blackbird');}var da=j(new g(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function ea(qa){var ra;for(ra in qa){var sa=qa[ra];if(ra==k.user){ca().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(sa){case da.WHITELISTED:case da.BLACKLISTED:case da.UNLISTED:break;default:ca().error('set_invalid_friend_visibility',{id:ra,value:sa});throw new Error("Invalid state: "+sa);}}for(ra in qa)u[ra]=qa[ra];da.inform('privacy-changed');}function fa(qa,ra){var sa={};sa[qa]=ra;ea(sa);}function ga(qa){switch(qa){case da.ONLINE:case da.OFFLINE:break;default:ca().error('set_invalid_visibility',{value:qa});throw new Error("Invalid visibility: "+qa);}v=qa;da.inform('privacy-changed');da.inform('privacy-user-presence-changed');g.inform('chat/visibility-changed',{sender:this});}function ha(qa){switch(qa){case da.ONLINE_TO_WHITELIST:case da.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+qa);}y=qa;da.inform('privacy-user-presence-changed');da.inform('privacy-changed');}function ia(qa,ra){ba=true;qa.send();}function ja(qa,ra){aa.push({request:qa,data:ra});if(!ba){var sa=aa.shift();ia(sa.request,sa.data);}}function ka(qa,ra){var sa=qa.type;if(sa===r){var ta=ra.payload.user_availabilities;if(!Array.isArray(ta)){da.inform('privacy-availability-changed',{user_availabilities:ta});for(var ua in qa.settings)w[ua]=qa.settings[ua];}}else{if(sa===s){x=qa.visibility;}else if(sa===t)z=qa.online_policy;da.inform('privacy-user-presence-response');}ca().log('set_update_response',{data:qa,response:ra});}function la(qa,ra){if(v!==x)ga(x);if(y!==z)ha(z);j(u,w);da.inform('privacy-changed');aa=[];ca().log('set_error_response',{data:qa,response:ra});}function ma(qa){ba=false;if(aa.length>0){var ra=aa.shift();ia(ra.request,ra.data);}}function na(qa,ra){if(m!=null){var sa=qa.getData();sa.window_id=m.getSessionID();qa.setData(sa);}qa.setHandler(ka.bind(this,ra)).setErrorHandler(la.bind(this,ra)).setTransportErrorHandler(la.bind(this,ra)).setFinallyHandler(ma.bind(this)).setAllowCrossPageTransition(true);return qa;}function oa(qa,ra,sa){return na(new h(qa).setData(ra),sa);}function pa(qa,ra){var sa=ra.obj;if(sa.viewer_id!=k.user){ca().error('invalid_viewer_for_channel_message',{type:qa,data:ra});throw new Error("Viewer got from the channel is not the real viewer");}if(sa.window_id===m.getSessionID())return;var ta=sa.data;if(sa.event=='access_control_entry'){ta.target_ids.forEach(function(va){fa(va,ta.setting);w[va]=ta.setting;});}else{if(sa.event=='visibility_update'){var ua=!!ta.visibility?da.ONLINE:da.OFFLINE;ga(ua);x=ua;}else if(sa.event=='online_policy_update'){ha(ta.online_policy);z=ta.online_policy;}da.inform('privacy-user-presence-response');}ca().log('channel_message_received',{data:ra.obj});}j(da,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(qa,ra,sa){},setVisibility:function(qa){x=v;ga(qa);var ra={visibility:qa},sa={type:s,visibility:qa},ta=oa(q,ra,sa);ja(ta,sa);ca().log('set_visibility',{data:ra});return qa;},getVisibility:function(){return v;},setOnlinePolicy:function(qa){z=y;ha(qa);var ra={online_policy:qa},sa={type:t,online_policy:qa},ta=oa(p,ra,sa);ja(ta,sa);ca().log('set_online_policy',{data:ra});return qa;},getOnlinePolicy:function(){return y;},getFriendVisibility:function(qa){return u[qa]||da.UNLISTED;},allows:function(qa){if(this.getVisibility()===da.OFFLINE)return false;var ra=this.getOnlinePolicy();return ra===da.ONLINE_TO_WHITELIST?u[qa]==da.WHITELISTED:u[qa]!=da.BLACKLISTED;},setFriendsVisibility:function(qa,ra){if(qa.length>0){var sa={};for(var ta=0;ta<qa.length;ta++){var ua=qa[ta];w[ua]=u[ua];sa[ua]=ra;}ea(sa);var va=ra;if(va==da.UNLISTED)va=w[qa[0]];var wa={users:qa,setting:ra,setting_type:va},xa={type:r,settings:sa},ya=oa(o,wa,xa);ja(ya,xa);ca().log('set_friend_visibility',{data:wa});}return ra;},setFriendVisibilityMap:function(qa,ra){for(var sa in qa)w[sa]=u[sa];ea(qa);var ta={type:r,settings:qa};ja(na(ra,ta),ta);ca().log('set_friend_visibility_from_map',{data:qa});},allow:function(qa){if(this.allows(qa)){ca().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===da.OFFLINE){ca().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_WHITELIST?da.WHITELISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},disallow:function(qa){if(!this.allows(qa)){ca().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===da.OFFLINE){ca().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var ra=this.getOnlinePolicy()===da.ONLINE_TO_BLACKLIST?da.BLACKLISTED:da.UNLISTED;return this.setFriendsVisibility([qa],ra);},getBlacklist:function(){var qa=[];for(var ra in u)if(u[ra]===da.BLACKLISTED)qa.push(ra);return qa;},getWhitelist:function(){var qa=[];for(var ra in u)if(u[ra]===da.WHITELISTED)qa.push(ra);return qa;},getMapForTest:function(){return u;},setMapForTest:function(qa){u=qa;}});da.inform('privacy-changed');da.inform('privacy-user-presence-changed');ca().log('initialized',{visibility:v,policy:y});g.subscribe(i.getArbiterType('privacy_changed'),pa.bind(this));g.subscribe(i.ON_CONFIG,function(qa,ra){var sa=ra.getConfig('visibility',null);if(sa!==null&&typeof(sa)!=='undefined'){var ta=sa?da.ONLINE:da.OFFLINE;ga(ta);ca().log('config_visibility',{vis:ta});}}.bind(this));a.PresencePrivacy=e.exports=da;},3);
__d("ChatVisibility",["Arbiter","JSLogger","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('JSLogger'),i=b('PresencePrivacy'),j={isOnline:function(){return i.getVisibility()===i.ONLINE;},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends();},isVisibleToMostFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_BLACKLIST&&i.getBlacklist().length>0;},isVisibleToSomeFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_WHITELIST&&i.getWhitelist().length>0;},goOnline:function(k){if(i.getVisibility()===i.OFFLINE){h.create('blackbird').log('chat_go_online');i.setVisibility(i.ONLINE);g.inform('chat-visibility/go-online');}k&&k();},goOffline:function(k){if(i.getVisibility()===i.ONLINE){h.create('blackbird').log('chat_go_offline');i.setVisibility(i.OFFLINE);g.inform('chat-visibility/go-offline');}k&&k();},toggleVisibility:function(){if(j.isOnline()){j.goOffline();}else j.goOnline();}};a.ChatVisibility=e.exports=j;},3);
__d("MovingStat",[],function(a,b,c,d,e,f){function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;});
__d("ChannelManager",["function-extensions","AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelInitialData","ChannelSubdomain","ChannelTransport","ChatVisibility","DTSG","Env","Event","FBAjaxRequest","JSLogger","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Run","SystemEvents","URI","UserActivity","copyProperties","createArrayFrom","setIntervalAcrossTransitions","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){b('function-extensions');var g=b('AjaxRequest'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('ChannelInitialData'),l=b('ChannelSubdomain'),m=b('ChannelTransport'),n=b('ChatVisibility'),o=b('DTSG'),p=b('Env'),q=b('Event'),r=b('FBAjaxRequest'),s=b('JSLogger'),t=b('MovingStat'),u=b('PresenceCookieManager'),v=b('PresenceState'),w=b('PresenceUtil'),x=b('Run'),y=b('SystemEvents'),z=b('URI'),aa=b('UserActivity'),ba=b('copyProperties'),ca=b('createArrayFrom'),da=b('setIntervalAcrossTransitions'),ea=b('setTimeoutAcrossTransitions'),fa,ga=s.create('channel'),ha=null;function ia(ta){ha=ta;}var ja={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ka={userActive:n.isOnline()?Date.now():0,sessionID:(Math.random()*2147483648|0).toString(16),streamingCapable:false,inStreaming:false,LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:30000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:3000,STREAMING_EXIT_STATE_ON_CONTINUE:false},la=1,ma={},na=0;function oa(){return i.lastSuccessTime?Math.round((Date.now()-i.lastSuccessTime)/1000):-1;}function pa(){var ta={};if(fa.getConfig('host'))ta[fa.getConfig('user_channel')]=fa.getConfig('seq',0);return ta;}function qa(){var ta=Date.now(),ua=Date.now(),va={total:0},wa='idle',xa=false;y.subscribe([y.USER,y.ONLINE,y.TIME_TRAVEL],function(ab,bb){sa(true);ua=null;fa.lastPullTime=Date.now();var cb;switch(ab){case y.USER:cb=y.isPageOwner()?j.SYS_OWNER:j.SYS_NONOWNER;break;case y.ONLINE:cb=bb?j.SYS_ONLINE:j.SYS_OFFLINE;break;case y.TIME_TRAVEL:cb=j.SYS_TIMETRAVEL;break;}fa.exitState({status:cb,stateId:la});});var ya=function(ab,bb){var cb=Date.now(),db;if(bb){ta=cb;db=bb.nextState||bb.state;}else db=wa;y.checkTimeTravel();if(ua){var eb=Math.round((cb-ua)/1000);if(eb>0){va[wa]=(va[wa]||0)+eb;va.total+=eb;}}wa=db;ua=cb;if(!ab){va.lastSuccessTime=oa();va.online=y.isOnline();ga.log('rollup',va);}};h.subscribe(j.ON_ENTER_STATE,ya);da(ya,60000);h.subscribe(s.DUMP_EVENT,function(ab,bb){bb.channelRollup=va;});var za=function(){if(fa.isShutdown()||fa.shouldIdle())return;y.checkTimeTravel();var ab=Date.now()-(fa.lastPullTime||p.start);if(!xa&&ab>ka.STALL_THRESHOLD){var bb=oa();ga.error('stall',{lastSuccessTime:bb,rollupState:wa});xa=true;}var cb=Date.now()-ta;if(fa.state=='pull'&&cb>ka.JUMPSTART_THRESHOLD){ta=null;ga.warn('jumpstart',{state:fa.state,dormant:cb});fa.enterState('init');}};da(za,10000);}function ra(){var ta=Date.now(),ua=1;function va(){ea(va,ua*1000);var ab=fa.state;if(ab=='idle'&&fa.shouldIdle())return;ga.bump('conn_t',ua);if(ab=='pull')ga.bump('conn_t_pull',ua);}va();var wa=[15,30,60,120,240],xa=false,ya=false;function za(ab){ea(function(){ga.rate('pullenter_'+ab,xa);ga.rate('pullexit_'+ab,ya);},ab*1000);}while(wa.length)za(wa.shift());h.subscribe(j.ON_ENTER_STATE,function(ab,bb){if(bb.state=='pull')xa=true;ta=Date.now();});h.subscribe(j.ON_EXIT_STATE,function(ab,bb){if(bb.state!='pull'||!ta)return;var cb='other';if(bb.status==j.OK){ya=true;cb='ok';}else if(bb.xhr&&bb.xhr.errorType){cb=/ar:(\w+)/.test(bb.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(bb.status))return;var db=(Date.now()-ta)/1000;if(db<0){return;}else if(db>3600)db=3600;ga.bump('conn_num');ga.bump('conn_exit',db);ga.bump('conn_num_'+cb);ga.bump('conn_exit_'+cb,db);});}function sa(ta){if(ta){na=0;ma={};}else na++;}fa={state:'idle',nextState:null,lastPullTime:Date.now(),heartbeats:[],setTestCallback:ia,init:function(ta){this.init=function(){};if(typeof(aa)!='undefined'){aa.subscribe(function(){if(n.isOnline())ka.userActive=Date.now();}.bind(this));}else ga.error('user_activity_undefined');u.register('ch',pa);var ua=this.getConfig('max_conn',2),va=Math.floor(Math.random()*32);ka.subdomain=l.allocate(ua,va);if(typeof window.onpageshow!='undefined'){q.listen(window,'pagehide',l.clear);}else x.onUnload(l.clear);this._transportRate=new t(30000);var wa=(g.supportsCORS()&&!ka.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new m[wa](this);if(ta)this.enterState.apply(this,arguments);h.subscribe(s.DUMP_EVENT,function(event,ya){ya.transportRate=this._transportRate.tally();ya.transportType=wa;ya.transportVersion=2;}.bind(this));qa();ra();if(fa.getConfig('tryStreaming')&&fa.getConfig('host')&&g.supportsCORS()&&!ka.forceIframe){var xa=ka.MIN_INIT_PROBE_DELAY+Math.random()*ka.INIT_PROBE_DELAY_RANDOMIZE_RANGE;ea(this._probeTest,xa);}},configure:function(){var ta=ca(arguments);ga.log('configure',ta);ta.forEach(ba.bind(null,ka));h.inform(j.ON_CONFIG,this);},getConfig:function(ta,ua){return ta in ka?ka[ta]:ua;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(y.isPageOwner()&&y.isOnline());},_sendIframeError:function(ta){var ua=new i().setURI('/ajax/presence/reconnect.php').setData({reason:ta,fb_dtsg:o.getToken()}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);ua.specifiesWriteRequiredParams()&&ua.send();},_getDelay:function(){var ta=Math.min(ka.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,na-1)),ka.MAX_RETRY_INTERVAL);return ta*(.75+Math.random()/2)|0;},enterState:function(){if(this._inEnterState)ga.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(ta){this._inEnterState=false;throw ta;}},_enterState:function(ta){var ua=0,va=ca(arguments);if(this.isShutdown())return;if(ta!='idle!'&&this.shouldIdle())return;la++;ka.stateId=la;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(ta)){var wa=this._transportRate.tally().timeAverage,xa=fa.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(wa>=xa){if(!this._throttled){this._throttled=true;ga.warn('throttled');}ga.bump('throttle');ua=1000/xa;}}else if(!(/#$/.test(ta)))ua=this._getDelay();ta=ta.replace(/\W*$/,'');if(!ja[ta])throw new Error('invalid state:'+ta);var ya;if(ua<=0){ya={state:ta};this._transportRate.add(1);this.state=ta;var za=this['_enter_'+this.state];if(za){va.shift();za.apply(this,va);}if(/init|idle|pull|ping/.test(this.state)){if(ka.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];this.transport.enterState(this.state,ka);if(this.state=='ping'){ya.url=m.getURI(ka).toString();ya.port=ka.port||'undefined';}}}else{this.state='idle';this.nextState=ta;ya={state:this.state,delay:ua,nextState:ta};va[0]=ta+'#';this._deferredTransition=(function(){this._deferredTransition=null;this.enterState.apply(this,va);}).bind(this).defer(ua,false);}if(/pull/.test(ta)){ya.client_id=ka.sessionID;ya.streaming=ka.inStreaming;}ga.log('enter_'+this.state,ya);h.inform(j.ON_ENTER_STATE,ya);},exitState:function(ta,ua){var va=ta.stateId,wa=ta.status;if(this.isShutdown()||va<la)return;var xa=ca(arguments),ya=this.state;xa[0]=ta.status;var za={state:ya,status:wa};if(/pull/.test(ya)){za.client_id=ka.sessionID;za.streaming=ka.inStreaming;}if(/ping/.test(ya)&&wa!=j.OK)za.url=m.getURI(ka).toString();if(this.nextState)za.nextState=this.nextState;if(ua&&ua.errorType){za.xhr=ua.toJSON?ua.toJSON():ua;delete za.xhr.json;}if(ua&&ua.json){if(ua.json.t)za.t=ua.json.t;if(ua.json.reason)za.reason=ua.json.reason;if(ua.json.seq)za.seq=ua.json.seq;}ga.log('exit_'+ya,za);h.inform(j.ON_EXIT_STATE,za);var ab=this['_exit_'+ya];if(ab)wa=ab.apply(this,xa)||wa;if(wa!=j.OK){sa();ma[ya]=(ma[ya]||0)+1;}var bb=ja[this.nextState||ya][wa]||ja._all[wa],cb=bb&&bb.replace(/!*$/,'');if(!cb){ga.error('terminal_transition',za);this._shutdownHint=j.HINT_INVALID_STATE;bb='shutdown!';}this._lastState=ya;this._lastStatus=wa;this.enterState(bb);},_processTransportData:function(ta,ua){var va=ua.json,wa=va.t;if('s' in va){va.seq=va.s;delete va.s;}var xa=ka.seq;if('seq' in va){ka.seq=va.seq;v.doSync();}switch(wa){case 'continue':if(ka.inStreaming&&this.heartbeats.length<1){ka.streamingCapable=false;ga.log('switch_to_longpoll');ea(this._probeTest,ka.PROBE_DELAY);}sa(true);if(!ka.inStreaming||ka.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:j.OK,stateId:ta});break;case 'refresh':case 'refreshDelay':this.exitState({status:'refresh_'+(va.reason||0),stateId:ta},ua);break;case 'fullReload':u.clear();ga.log('invalid_history');h.inform(j.ON_INVALID_HISTORY);this.exitState({status:j.ERROR_MISSING,stateId:ta},ua);break;case 'msg':var ya,za,ab,bb;sa(true);za=va.ms;ab=ka.seq-za.length;for(ya=0;ya<za.length;ya++,ab++)if(ab>=xa){bb=za[ya];if(bb.type){if(bb.type==='messaging'&&bb.message){var cb=bb.unread_counts&&bb.unread_counts.inbox;ga.debug('message',{type:'messaging',inbox_unread:cb,tid:bb.message.tid,mid:bb.message.mid});}else if(bb.type==='m_messaging'){ga.debug('message',{type:'m_messaging',tid:bb.tid,mid:bb.uuid});}else ga.debug('message',{type:bb.type});h.inform(j.getArbiterType(bb.type),{obj:bb});}}else ga.warn('seq_regression',{seq:ab,last_seq:xa,messages:za.length});break;case 'heartbeat':if(ka.inStreaming){var db=Date.now();if(this.heartbeats.length>0){var eb=db-this.heartbeats[this.heartbeats.length-1];ga.log('heartbeat_interval',{client_id:ka.sessionID,interval:eb});}this.heartbeats.push(db);}break;default:ga.error('unknown_msg_type',{type:wa});break;}},_enter_init:function(){if(ma.init>=fa.getConfig('MAX_INIT_FAILS',2))return this.exitState.bind(this,{status:j.ERROR_MAX,stateId:la}).defer();this._initTimer=this.exitState.bind(this,{status:j.ERROR,stateId:la},'timeout').defer(ka.IFRAME_LOAD_TIMEOUT,false);},_enter_reconnect:function(ta){var ua=la;if(!w.hasUserCookie()){ga.warn('no_user_cookie');(function(){fa._shutdownHint=j.HINT_AUTH;fa.exitState({status:j.ERROR_SHUTDOWN,stateId:ua});}).defer();return;}var va={reason:ta,fb_dtsg:o.getToken()};if(p.fb_isb)va.fb_isb=p.fb_isb;if(ha)ha(va);var wa=new r('GET','/ajax/presence/reconnect.php',va);wa.onSuccess=(function(){fa.configure(wa.json);u.store();this.exitState({status:j.OK,stateId:ua});}).bind(this);wa.onError=(function(){var xa=wa.json&&wa.json.error;if(wa.errorType==g.TRANSPORT_ERROR||wa.errorType==g.PROXY_ERROR)this._shutdownHint=j.HINT_CONN;if(xa&&xa==1356007){this._shutdownHint=j.HINT_MAINT;}else if(xa==1357001||xa==1357004||xa==1348009){this._shutdownHint=j.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?j.ERROR_SHUTDOWN:j.ERROR,stateId:ua},wa);}).bind(this);wa.send();},_enter_shutdown:function(){h.inform(j.ON_SHUTDOWN,{reason:this._shutdownHint});},_exit_init:function(ta){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(ta==j.ERROR_MAX)this._sendIframeError(j.reason_IFrameLoadGiveUp);},_exit_pull:function(ta){if(ta==j.OK)this.lastPullTime=Date.now();},_exit_ping:function(ta){if(ta==j.OK){var ua=Date.now()-(this.lastPullTime||p.start);if(ua>ka.STALL_THRESHOLD)return j.ERROR_STALE;}},_probeTest:function(){ka.streamingCapable=false;var ta=[],ua={mode:'stream',format:'json'},va=new z('/probe').setDomain(ka.host+'.facebook.com').setPort(ka.port).setSecure(z().isSecure()).setQueryData(ua),wa=new g('GET',va);wa.onJSON=function(xa,ya){if(xa&&xa.json&&xa.json.t==='heartbeat'){ta.push(Date.now());if(ta.length>=2){var za=ta[1]-ta[0];if(za>=ka.PROBE_HEARTBEATS_INTERVAL_LOW&&za<=ka.PROBE_HEARTBEATS_INTERVAL_HIGH){ka.streamingCapable=true;ga.log('switch_to_streaming');}ga.log('probe_ok',{time:za});}}};wa.onSuccess=function(xa){if(ta.length!=2){ka.streamingCapable=false;ga.error('probe_error',{error:'beats.length = '+ta.length});}};wa.onError=function(xa){ka.streamingCapable=false;ga.error('probe_error',xa);};ga.log('probe_request');wa.send();}};e.exports=fa;if(k.channelConfig){fa.configure(k.channelConfig);if(/shutdown/.test(k.state))fa._shutdownHint=j[k.reason];fa.init(k.state,k.reason);}});
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ChatConfig'),j=b('Run'),k=b('SystemEvents'),l=b('ChannelConstants'),m=b('ChannelManager'),n=b('JSLogger'),o=b('setTimeoutAcrossTransitions'),p=n.create('channel_connection'),q=null,r=null,s=null,t=null,u=0,v=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function w(){if(r){clearTimeout(r);r=null;}}function x(){w();p.log('unmute_warning');v.inform(v.UNMUTE_WARNING);}function y(ca){w();r=x.defer(ca,false);p.log('mute_warning',{time:ca});v.inform(v.MUTE_WARNING);}function z(){if(s){clearTimeout(s);s=null;}}function aa(ca,da){z();if(ca===l.ON_ENTER_STATE&&(da.nextState||da.state)==='pull'){if(t!==v.CONNECTED){p.log('connected');var ea=!t;t=v.CONNECTED;u=0;v.inform(v.CONNECTED,{init:ea});}}else if(ca===l.ON_ENTER_STATE&&((da.nextState||da.state)==='ping'||(!da.nextState&&da.state==='idle'))){s=(function(){var fa=null;if(!(da.state==='idle'&&!da.nextState))fa=(da.delay||0);p.log('reconnecting',{delay:fa});if(v.disconnected())p.log('reconnecting_ui',{delay:fa});t=v.RECONNECTING;(da.state==='idle')&&u++;if(u>1){v.inform(v.RECONNECTING,fa);}else if(!da.nextState&&da.state==='idle')aa(ca,da);}).defer(500,false);}else if(ca===l.ON_SHUTDOWN){p.log('shutdown',{reason:da.reason});t=v.SHUTDOWN;u=0;v.inform(v.SHUTDOWN,da.reason);}}function ba(ca){if(m.state==='ping'||m.isShutdown())return;p.log('reconnect',{now:ca});v.inform(v.RECONNECTING,0);if(!!ca){if(q!==null){clearTimeout(q);q=null;}m.enterState('ping!');}else if(!q)q=o(function(){m.enterState('ping!');q=null;},i.get('channel_manual_reconnect_defer_msec'));}if(m.isShutdown()){aa(l.ON_SHUTDOWN,m._shutdownHint);}else aa(l.ON_ENTER_STATE,{state:m.state,nextState:m.nextState,delay:0});g.subscribe([l.ON_ENTER_STATE,l.ON_SHUTDOWN],aa);k.subscribe(k.TIME_TRAVEL,function(){ba();y(i.get('mute_warning_time_msec'));});j.onBeforeUnload(z,false);h(v,{disconnected:function(){return t===v.SHUTDOWN||(t===v.RECONNECTING&&!r&&u>1);},isShutdown:function(){return t===v.SHUTDOWN;},reconnect:ba,unmuteWarning:x});e.exports=v;});
__d("ChatFavoriteList",["AsyncRequest","arrayContains","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('arrayContains'),i=b('emptyFunction'),j=false,k=[],l=[],m=false;function n(){var r=k.join(',');new g('/ajax/chat/favorite_list.php').setData({favorite_list:r}).setHandler(i).setErrorHandler(i).send();}function o(r){return r.toString();}function p(r){if(k.length!=r.length)return true;for(var s=0;s<r.length;s++)if(k[s]!==r[s].toString())return true;return false;}var q={isEditMode:function(){var r=null;d(['ChatSidebar'],function(s){r=s;});return j&&r&&r.isEnabled();},toggleEditMode:function(){j=!j;if(j)l=k.slice();},get:function(){if(j){return l.slice();}else return k.slice();},isFavored:function(r){return h(l,r.toString());},init:function(r){k=r.slice().map(o);l=k.slice();},toggleID:function(r){if(!j)return;r=r.toString();var s=l.indexOf(r);if(s>=0){l.splice(s,1);}else l.push(r);m=true;},hasChanged:function(){if(m){m=false;return true;}return false;},updateList:function(r){if(!j)return;l=r.map(o);},save:function(){if(p(l)){k=l;n();}}};e.exports=q;});
__d("ChatContexts",[],function(a,b,c,d,e,f){var g={};function h(k){var l=k?k.subtext:'';return l;}function i(k,l){g[k]=l;}var j={get:function(k){if(k in g){return g[k];}else return null;},update:function(k){for(var l in k)i(l,k[l]);},getShortDisplay:function(k){return h(j.get(k));}};e.exports=j;});
__d("Poller",["ArbiterMixin","AsyncRequest","Cookie","Env","copyProperties","emptyFunction","mixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('Cookie'),j=b('Env'),k=b('copyProperties'),l=b('emptyFunction'),m=b('mixin'),n=m(g);for(var o in n)if(n.hasOwnProperty(o))q[o]=n[o];var p=n===null?null:n.prototype;q.prototype=Object.create(p);q.prototype.constructor=q;q.__superConstructor__=n;function q(t){"use strict";this._config=k({clearOnQuicklingEvents:true,setupRequest:l,interval:null,maxRequests:Infinity,dontStart:false},t);if(!this._config.dontStart)this.start();}q.prototype.start=function(){"use strict";if(this._polling)return this;this._requests=0;this.request();return this;};q.prototype.stop=function(){"use strict";this._cancelRequest();return this;};q.prototype.mute=function(){"use strict";this._muted=true;return this;};q.prototype.resume=function(){"use strict";if(this._muted){this._muted=false;if(!this._handle&&this._polling)return this.request();}return this;};q.prototype.skip=function(){"use strict";this._skip=true;return this;};q.prototype.reset=function(){"use strict";return this.stop().start();};q.prototype.request=function(){"use strict";this._cancelRequest();this._polling=true;if(!s())return this._done();if(this._muted)return this;if(++this._requests>this._config.maxRequests)return this._done();var t=new h(),u=false;t.setInitialHandler(function(){return !u;});this._cancelRequest=function(){u=true;this._cleanup();}.bind(this);t.setFinallyHandler(r.bind(this));t.setInitialHandler=l;t.setFinallyHandler=l;this._config.setupRequest(t,this);if(this._skip){this._skip=false;r.bind(this).defer();}else t.send();return this;};q.prototype.isPolling=function(){"use strict";return this._polling;};q.prototype.isMuted=function(){"use strict";return this._muted;};q.prototype.setInterval=function(t){"use strict";if(t){this._config.interval=t;this.start();}};q.prototype.getInterval=function(){"use strict";return this._config.interval;};q.prototype._cleanup=function(){"use strict";if(this._handle)clearTimeout(this._handle);this._handle=null;this._cancelRequest=l;this._polling=false;};q.prototype._done=function(){"use strict";this._cleanup();this.inform('done',{sender:this});return this;};q.MIN_INTERVAL=2000;k(q.prototype,{_config:null,_requests:0,_muted:false,_polling:false,_skip:false,_cancelRequest:l});function r(){if(!this._polling)return;if(this._requests<this._config.maxRequests){var t=this._config.interval;t=typeof t==='function'?t(this._requests):t;this._handle=this.request.bind(this).defer((t>q.MIN_INTERVAL)?t:q.MIN_INTERVAL,this._config.clearOnQuicklingEvents);}else this._done();}function s(){return j.user==i.get('c_user');}e.exports=q;});
__d("PresenceStatus",["AvailableListConstants","ChatConfig","ChatVisibility","Env","PresencePrivacy","ServerTime","createObjectFrom"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('ChatVisibility'),j=b('Env'),k=b('PresencePrivacy'),l=b('ServerTime'),m=b('createObjectFrom'),n={},o={},p={},q={},r={},s={resetPresenceData:function(){n={};r={};q={};},reset:function(){s.resetPresenceData();o={};p={};},get:function(t){if(t==j.user)return i.isOnline()?g.ACTIVE:g.OFFLINE;var u=g.OFFLINE;if(t in n)u=n[t];if(u==g.OFFLINE)if(o[t])u=g.MOBILE;if(!k.allows(t))u=g.OFFLINE;return u;},isBirthday:function(t){return p[t];},getGroup:function(t){if(!h.get('chat_group_presence',0))return g.OFFLINE;return t.some(function(u){if(u==j.user)return false;return (s.get(u)===g.ACTIVE);})?g.ACTIVE:g.OFFLINE;},set:function(t,u,v,w){if(t==j.user)return false;switch(u){case g.OFFLINE:case g.IDLE:case g.ACTIVE:case g.MOBILE:break;default:return false;}var x=s.get(t)!=u;if(v){q[t]=l.get();r[t]=w;}n[t]=u;return x;},setMobileFriends:function(t){o=m(t);},setBirthdayFriends:function(t){p=m(t);},getOnlineIDs:function(){var t,u=[];for(t in n)if(s.get(t)===g.ACTIVE)u.push(t);return u;},getAvailableIDs:function(){var t=s.getOnlineIDs(),u;for(u in o){if(n[u])continue;t.push(u);}return t;},getOnlineCount:function(){return s.getOnlineIDs().length;},getPresenceStats:function(){var t=0,u=0,v=0,w=0,x=0;for(var y in n){t+=1;switch(s.get(y)){case g.OFFLINE:u+=1;break;case g.IDLE:v+=1;break;case g.ACTIVE:w+=1;break;case g.MOBILE:x+=1;break;default:break;}}return {total:t,offline:u,idle:v,active:w,mobile:x};},getDebugInfo:function(t){return {id:t,presence:n[t],overlaySource:r[t],overlayTime:q[t],mobile:o[t]};}};e.exports=s;});
__d("PresencePoller",["AvailableListConstants","AvailableListInitialData","BanzaiODS","ChannelImplementation","ChatContexts","ChatFavoriteList","ChatVisibility","Env","JSLogger","LastMobileActiveTimes","Poller","PresenceStatus","ServerTime","ShortProfiles","UserActivity","copyProperties","debounceAcrossTransitions"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('AvailableListInitialData'),i=b('BanzaiODS'),j=b('ChannelImplementation').instance,k=b('ChatContexts'),l=b('ChatFavoriteList'),m=b('ChatVisibility'),n=b('Env'),o=b('JSLogger'),p=b('LastMobileActiveTimes'),q=b('Poller'),r=b('PresenceStatus'),s=b('ServerTime'),t=b('ShortProfiles'),u=b('UserActivity'),v=b('copyProperties'),w=b('debounceAcrossTransitions'),x=30,y=5,z='/ajax/chat/buddy_list.php',aa=1800000,ba=h.pollInterval,ca=h.lazyPollInterval,da=h.lazyThreshold,ea=o.create('available_list'),fa='presence_poller';i.setEntitySample(fa,.01);function ga(ha){"use strict";this.$PresencePoller0=ha;this.$PresencePoller1=false;this.$PresencePoller2=h.chatNotif;this.$PresencePoller3=new q({interval:ba,setupRequest:this.$PresencePoller4.bind(this),clearOnQuicklingEvents:false,dontStart:true});if(h.availableCount>=x){this.$PresencePoller5=Date.now();this.$PresencePoller6=Date.now();this.$PresencePoller7=Date.now();this.$PresencePoller8=h.updateTime;}else{this.$PresencePoller5=0;this.$PresencePoller8=0;this.$PresencePoller6=0;this.$PresencePoller7=0;}this.$PresencePoller9=false;this.$PresencePollera=0;if(h.favoriteList)l.init(h.favoriteList);this.$PresencePollerb('available_initial_data',h.updateTime,h.availableList,h.lastActiveTimes,h.mobileFriends,h.birthdayFriends);u.subscribe(function(ia,ja){if(ja.idleness>ba)this.forceUpdate();}.bind(this));}ga.prototype.start=function(){"use strict";this.$PresencePoller3.start.bind(this.$PresencePoller3).defer();};ga.prototype.forceUpdate=function(){"use strict";if(!this.$PresencePoller9)this.$PresencePoller3.request();};ga.prototype.getIsUserIdle=function(){"use strict";return this.$PresencePoller1;};ga.prototype.getWebChatNotification=function(){"use strict";return this.$PresencePoller2;};ga.prototype.getCallback=function(){"use strict";return this.$PresencePoller0;};ga.prototype.$PresencePollerc=function(){"use strict";return w(function(){this.$PresencePoller0(g.ON_AVAILABILITY_CHANGED);}.bind(this),0)();};ga.prototype.$PresencePollerb=function(ha,ia,ja,ka,la,ma){"use strict";this.$PresencePoller8=ia;if(!Array.isArray(ja)){r.resetPresenceData();for(var na in ja)r.set(na,ja[na].a,false,ha);}if(ka)p.update(ka,ia);if(la)r.setMobileFriends(la);if(ma)r.setBirthdayFriends(ma);this.$PresencePollerc();};ga.prototype.$PresencePoller4=function(ha){"use strict";if(j.isShutdown()||!m.isOnline()){this.$PresencePoller3.skip();i.bumpEntityKey(fa,'skip.offline');return;}if(Date.now()-this.$PresencePoller5<ba){this.$PresencePoller3.skip();i.bumpEntityKey(fa,'skip.recent');return;}i.bumpEntityKey(fa,'request');this.$PresencePoller5=Date.now();var ia=(Date.now()-this.$PresencePoller7>aa),ja=t.getCachedProfileIDs().join(",");this.$PresencePoller9=true;ha.setHandler(this.$PresencePollerd.bind(this)).setErrorHandler(this.$PresencePollere.bind(this)).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:n.user,cached_user_info_ids:ja,fetch_mobile:ia}).setURI(z).setAllowCrossPageTransition(true);};ga.prototype.$PresencePollerd=function(ha){"use strict";var ia=ha.getPayload(),ja=ia.buddy_list;if(!ja){this.$PresencePollere(ha);return;}i.bumpEntityKey(fa,'response');this.$PresencePoller9=false;this.$PresencePollerf();this.$PresencePoller6=Date.now();s.update(ia.time);if(ja.mobile_friends)this.$PresencePoller7=Date.now();this.$PresencePollera=0;this.$PresencePollerg();var ka=ja.userInfos;if(ka)t.setMulti(ka);var la=ja.chatContexts;la&&k.update(la);this.$PresencePoller1=ja.userIsIdle;if(ja.chatNotif!==undefined){this.$PresencePoller2=ja.chatNotif;this.$PresencePoller0(g.ON_CHAT_NOTIFICATION_CHANGED,this.$PresencePoller2);}this.$PresencePollerb('buddy_list_poller',ia.time,ja.nowAvailableList,ja.last_active_times,ja.mobile_friends,ja.todays_birthdays);};ga.prototype.$PresencePollere=function(ha){"use strict";i.bumpEntityKey(fa,'error');if(ha.getError()==1356007)return;this.$PresencePoller9=false;this.$PresencePollera++;if(this.$PresencePollera++>=y)this.$PresencePoller0(g.ON_UPDATE_ERROR);};ga.prototype.$PresencePollerg=function(){"use strict";var ha=u.isActive(da)?ba:ca;i.bumpEntityKey(fa,'period.'+ha);this.$PresencePoller3.setInterval(ha);};ga.prototype.$PresencePollerf=function(){"use strict";var ha=Date.now(),ia=ha-this.$PresencePoller6;ea.log('buddylist_presence_stats',v({duration:ia},r.getPresenceStats()));};e.exports=ga;});
__d("AvailableList",["function-extensions","Arbiter","ArbiterMixin","AsyncRequest","AvailableListConstants","ChannelImplementation","ChannelConstants","ChatConfig","ChatFavoriteList","JSLogger","PresencePoller","PresencePrivacy","PresenceStatus","ShortProfiles","TypingDetector","copyProperties","debounceAcrossTransitions","emptyFunction"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('AvailableListConstants'),k=b('ChannelImplementation').instance,l=b('ChannelConstants'),m=b('ChatConfig'),n=b('ChatFavoriteList'),o=b('JSLogger'),p=b('PresencePoller'),q=b('PresencePrivacy'),r=b('PresenceStatus'),s=b('ShortProfiles'),t=b('TypingDetector'),u=b('copyProperties'),v=b('debounceAcrossTransitions'),w=b('emptyFunction'),x=u({},j,h);x.subscribe([j.ON_AVAILABILITY_CHANGED,j.ON_UPDATE_ERROR],function(ea,fa){g.inform(ea,fa);});var y=v(function(){x.inform(j.ON_AVAILABILITY_CHANGED);},0);function z(ea,fa,ga,ha){var ia=r.set(ea,fa,ga,ha);if(ia)y();}function aa(ea){var fa=ea.payload.availability||{};for(var ga in fa)z(ga,fa[ga],true,'mercury_tabs');}function ba(ea){var fa=x.getDebugInfo(ea),ga=(fa.presence==j.ACTIVE),ha=new i('/ajax/mercury/tabs_presence.php').setData({target_id:ea,to_online:ga,presence_source:fa.overlaySource,presence_time:fa.overlayTime}).setHandler(aa).setErrorHandler(w).setAllowCrossPageTransition(true).send();}function ca(ea,fa){fa.chat_config=m.getDebugInfo();fa.available_list_debug_info={};x.getAvailableIDs().forEach(function(ga){fa.available_list_debug_info[ga]=x.getDebugInfo(ga);});fa.available_list_poll_interval=x._poller&&x._poller.getInterval();}var da=new p(function(event){x.inform(event);});u(x,{get:function(ea){return r.get(ea);},updateForID:function(ea){ba(ea);},getWebChatNotification:function(){return da.getWebChatNotification();},isUserIdle:function(){return da.getIsUserIdle();},isReady:function(){return true;},set:function(ea,fa,ga){z(ea,fa,true,ga);},update:function(){da.forceUpdate();},isIdle:function(ea){return x.get(ea)==j.IDLE;},getOnlineIDs:function(){return r.getOnlineIDs();},getAvailableIDs:function(){return r.getAvailableIDs();},getOnlineCount:function(){return r.getOnlineCount();},getDebugInfo:function(ea){var fa=r.getDebugInfo(ea),ga=s.getNow(ea);if(ga)fa.name=ga.name;return fa;}});da.start();g.subscribe(o.DUMP_EVENT,ca);g.subscribe(l.getArbiterType('favorite_list'),function(ea,fa){var ga=fa.obj,ha=ga.value?ga.value.split(','):[];n.init(ha);y();});q.subscribe(['privacy-changed','privacy-availability-changed','privacy-user-presence-response'],y);k.subscribe([k.CONNECTED,k.RECONNECTING,k.SHUTDOWN,k.MUTE_WARNING,k.UNMUTE_WARNING],y);g.subscribe(l.getArbiterType('buddylist_overlay'),function(ea,fa){var ga=fa.obj.overlay;for(var ha in ga)x.set(ha,ga[ha].a,ga[ha].s||'channel');});g.subscribe([l.getArbiterType('typ'),l.getArbiterType('ttyp')],function(ea,fa){var ga=fa.obj;if(ga.st===t.TYPING){var ha=ga.from;x.set(ha,j.ACTIVE,'channel-typing');}});a.AvailableList=e.exports=x;});
__d("ChatTypeaheadConstants",[],function(a,b,c,d,e,f){var g={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',FB4C_TYPE:'fb4c',HEADER_TYPE:'header'};e.exports=g;});
__d("Chat",["Arbiter","ChatTypeaheadConstants","MercuryParticipantTypes"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatTypeaheadConstants'),i=b('MercuryParticipantTypes');function j(o,p){d(['ChatImpressionLogger','PresenceStatus'],function(q,r){var s=p&&p.source;if(s&&s==='ordered_list'||s==='more_online_friends'||s==='online_friends'||s==='recent_threads_in_divebar_new'||s==='recent_threads_in_divebar'||s==='presence'||s==='typeahead'){p.viewport_width=document.body.clientWidth;p.target=o;p.target_presence=r.get(o);q.logImpressions(p);}});}var k={buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function l(o,p){g.subscribe(k[o],function(event,q){p(q);});}function m(){return (Math.random()*2147483648|0).toString(16);}var n={openTab:function(o,p,q){if(window.External&&window.External.Chat&&window.External.Chat.openWindow)window.External.Chat.openWindow(o);j.curry(o,q).defer();d(['MercuryThreads'],function(r){if(!p||p===i.FRIEND||p===h.FRIEND_TYPE||p===h.USER_TYPE){var s=r.get().getCanonicalThreadToUser(o),t=m();g.inform('chat/open-tab',{thread_id:s.thread_id,signature_id:t});return;}if(p===h.THREAD_TYPE)d(['ChatOpenTab'],function(u){if(o){u.openThread(o);}else u.openEmptyTab();});});},openBuddyList:function(){l('buddyListNub',function(o){o.show();l('sidebar',function(p){p.enable();});});},closeBuddyList:function(){l('buddyListNub',function(o){o.hide();});},toggleSidebar:function(){l('sidebar',function(o){o.toggle();});},goOnline:function(o){d(['ChatVisibility'],function(p){p.goOnline(o);});},isOnline:function(){var o=null;d(['ChatVisibility'],function(p){o=p;});return o&&o.isOnline();}};a.Chat=e.exports=n;},3);
__d("ChatQuietLinks",["Event","DOM","UserAgent","DataStore","Parent"],function(a,b,c,d,e,f){var g=b('Event'),h=b('DOM'),i=b('UserAgent'),j=b('DataStore'),k=b('Parent'),l={},m={silenceLinks:function(q){n(q,this.removeEmptyHrefs.bind(this));},nukeLinks:function(q){n(q,this.removeAllHrefs.bind(this));},removeEmptyHrefs:function(q){o(q,function(r){return !r||r==='#';});},removeAllHrefs:function(q){o(q);},removeMessagesHrefs:function(q){o(q,function(r){return !r||r==='#'||r.indexOf('/messages/')!=-1;});}};function n(q,r){var s=!!i.chrome(),t=!!i.chrome()||i.ie()>=9||i.firefox()>=4;if(l[h.getID(q)])return;l[h.getID(q)]=true;if(!t)return;if(!s){r&&r(q);return;}g.listen(q,'mouseover',function u(v){var w=k.byTag(v.getTarget(),'a');if(w){var x=w.getAttribute('href');if(p(x)){j.set(w,'stashedHref',w.getAttribute('href'));w.removeAttribute('href');}}});g.listen(q,'mouseout',function u(v){var w=k.byTag(v.getTarget(),'a'),x=w&&j.remove(w,'stashedHref');if(p(x))w.setAttribute('href',x);});g.listen(q,'mousedown',function(u){if(!u.isDefaultRequested())return true;var v=k.byTag(u.getTarget(),'a'),w=v&&j.get(v,'stashedHref');if(p(w))v.setAttribute('href',w);});}function o(q,r){var s=h.scry(q,'a');if(r)s=s.filter(function(t){return r(t.getAttribute('href'));});s.forEach(function(t){t.removeAttribute('href');t.setAttribute('tabindex',0);});}function p(q){return q&&q!=='#';}e.exports=m;});
__d("ChatSidebarConstants",[],function(a,b,c,d,e,f){var g={LITESTAND_IMAGE_SIZE:24,LITESTAND_BLENDED_SIZE:32,LITESTAND_CLASSIC_SIZE:32,IMAGE_SIZE:28};e.exports=g;});
__d("ChatSidebarItem.react",["AvailableListConstants","ChatConfig","ChatFavoriteList","ChatSidebarConstants","Image.react","Link.react","React","SplitImage.react","cx","ix"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('ChatFavoriteList'),j=b('ChatSidebarConstants'),k=b('Image.react'),l=b('Link.react'),m=b('React'),n=b('SplitImage.react'),o=b('cx'),p=b('ix'),q=9,r=m.createClass({displayName:'ChatSidebarItem',render:function(){var s=(("_55ln")+(this.props.context?' '+"_55lo":'')+(this.props.unreadCount&&h.get('litestand_buddylist_count')?' '+"_5bom":'')),t;if(this.props.litestandSidebar)t=m.DOM.div({'aria-label':this.props.name,className:"_4_vf",'data-hover':"tooltip",'data-tooltip-position':"right"});return (l({className:s,href:this.props.href,onClick:this.props.onClick,rel:"ignore"},m.DOM.div({className:"_55lp"},this.renderFavorite(),m.DOM.div({className:"_56p9"},this.renderImage(),m.DOM.div({className:"_568w"})),m.DOM.div({className:"_5bon"},this.renderBirthday(),this.renderUnreadCount(),this.renderStatus()),m.DOM.div({className:"_55lr"},this.props.name),m.DOM.div({className:"_55ls"},this.props.context)),t));},renderFavorite:function(){if(this.props.isAdded===undefined)return null;var s=null;if(this.props.litestandSidebar){s=this.props.isAdded?p('/images/litestand/bookmarks/sidebar/remove.png'):p('/images/litestand/bookmarks/sidebar/add.png');}else s=this.props.isAdded?p('/images/chat/delete.png'):p('/images/chat/add.png');var t=(("_568x")+(!this.props.showEditButton?' '+"hidden_elem":''));return (m.DOM.div({className:t,onClick:this.props.onEditClick},k({className:"_568y",src:s})));},renderImage:function(){var s=this.props.imageSize||j.IMAGE_SIZE;return n({size:s,srcs:this.props.images});},renderUnreadCount:function(){var s=this.props.unreadCount;if(!s||!h.get('litestand_buddylist_count'))return null;var t=(("_5boo")+(s>q?' '+"_5bop":''));if(s>q)s=q+'+';return (m.DOM.div({className:t},s));},renderStatus:function(){var s=this.getStatusSrc();if(!s)return null;if(this.props.unreadCount&&h.get('litestand_blended_sidebar')&&h.get('litestand_buddylist_count'))return;var t=h.get('divebar_favorite_list',0)&&i.isEditMode();if(t)return;return (m.DOM.div({className:"_568z"},m.DOM.div({className:"_568-"},this.props.statusTime),k({className:"_568_",src:s})));},renderBirthday:function(){if(!this.props.birthday)return null;var s=p('/images/gifts/icons/cake_icon.png');if(h.get('gray_cake'))s=p('/images/chat/sidebar/livebar/divebar_cake.png');return (k({className:"_5dv3",src:s}));},getStatusSrc:function(){switch(this.props.status){case g.ACTIVE:case g.IDLE:if(this.props.litestandSidebar)return h.get('litestand_blended_sidebar')?p('/images/litestand/sidebar/blended/online.png'):p('/images/litestand/sidebar/online.png');return h.get('litestand_classic_sidebar')?p('/images/litestand_classic/sidebar/online.png'):p('/images/chat/status/online.png');case g.MOBILE:if(this.props.litestandSidebar)return h.get('litestand_blended_sidebar')?p('/images/litestand/sidebar/blended/pushable.png'):p('/images/litestand/sidebar/pushable.png');return h.get('litestand_classic_sidebar')?p('/images/litestand_classic/sidebar/pushable.png'):p('/images/chat/status/mobile.png');}return null;}});e.exports=r;});
__d("ChatSidebarThread.react",["ChatSidebarItem.react","WebMessengerPermalinkConstants","React","MercuryThreadMetadataRawRenderer"],function(a,b,c,d,e,f){var g=b('ChatSidebarItem.react'),h=b('WebMessengerPermalinkConstants'),i=b('React'),j=b('MercuryThreadMetadataRawRenderer'),k=i.createClass({displayName:'ChatSidebarThread',render:function(){var n=this.props.name,o=l(this.props.threadID,this.props.participants),p=n?o:undefined,q=h.getURIPathForThreadID(this.props.threadID),r=m(this.props.image,this.props.participants),s=n?n:o;return (g({context:p,href:{url:q},imageSize:this.props.imageSize,images:r,litestandSidebar:this.props.litestandSidebar,name:s,status:this.props.status,unreadCount:this.props.unreadCount}));}});function l(n,o){return j.renderRawParticipantList(n,o,o.length,{names_renderer:j.renderShortNames});}function m(n,o){if(n)return n;return o.map(function(p){return p.image_src;});}e.exports=k;});
__d("ChatUnreadCount",["ArbiterMixin","MercuryThreadInformer","MercuryThreads","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('MercuryThreadInformer').get(),i=b('MercuryThreads').get(),j=b('copyProperties'),k={};h.subscribe('threads-updated',function(l,m){for(var n in m){var o=i.getCanonicalUserInThread(n);k.inform('unread-changed',o);}});j(k,g,{getUnreadCountForUID:function(l,m){i.getThreadMeta(i.getThreadIdForUser(l),function(n){m(n.unread_count);});}});e.exports=k;});
__d("OrderedFriendsList",["AvailableList","ChatConfig","createArrayFrom","ShortProfiles","InitialChatFriendsList"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('ChatConfig'),i=b('createArrayFrom'),j=b('ShortProfiles'),k=[],l={},m=[],n={contains:function(o){return o in l;},compare:function(o,p){var q=n.getRank(o),r=n.getRank(p);if(q!==r)return q-r;var s=j.getNowUnsafe(o),t=j.getNowUnsafe(p),u=((s||{}).name||'~').toLowerCase(),v=((t||{}).name||'~').toLowerCase();if(u!==v)return u<v?-1:1;return 0;},getList:function(){if(h.get('chat_web_ranking_with_presence'))n.reRank();var o=i(k);o=o.filter(function(p){var q=j.getNowUnsafe(p);return !q||q.type=="friend";});return o;},getRank:function(o){return o in l?l[o]:k.length;},reRank:function(){var o={},p={};m.forEach(function(r,s){var t=r.substr(0,r.length-2),u=r.substring(r.length-1);if(typeof(p.uid)=='undefined'){if(typeof(o.uid)=='undefined')o[t]=g.get(t);var v=o[t];if(v==u)p[s]=t;}});k=[];for(var q in p)k.push(p[q]);k.forEach(function(r,s){l[r]=s;});}};(function(){var o=b('InitialChatFriendsList');k=o.list.length?o.list:[];if(h.get('chat_web_ranking_with_presence')){m=k.slice();n.reRank();}k.forEach(function(p,q){l[p]=q;});})();e.exports=a.OrderedFriendsList||n;});
__d("ChatOrderedList",["Animation","Arbiter","ArbiterMixin","AsyncDialog","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","Chat","ChatConfig","ChatContexts","ChatFavoriteList","ChatGroupThreadsController","ChatOrderedListHover","ChatQuietLinks","ChatSidebarThreadlist.react","ChatTypeaheadConstants","ChatUnreadCount","ChatVisibility","CSS","DataStore","DOM","Ease","Event","ImageSourceRequest","ImageSourceType","JSLogger","JSXDOM","LastMobileActiveTimes","MercuryParticipantTypes","OrderedFriendsList","Parent","PhotoResizeModeConst","PresencePrivacy","PresenceStatus","React","Rect","ShortProfiles","Style","TokenizeUtil","Tooltip","URI","Vector","XHPTemplate","copyProperties","createObjectFrom","csx","cx","debounceAcrossTransitions","guid","ix","requestAnimationFrame","runAfterScrollingStops","shield","throttle","tx","mixin","ChannelImplementation"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('AsyncDialog'),k=b('AsyncRequest'),l=b('AvailableList'),m=b('AvailableListConstants'),n=b('Bootloader'),o=b('Chat'),p=b('ChatConfig'),q=b('ChatContexts'),r=b('ChatFavoriteList'),s=b('ChatGroupThreadsController'),t=b('ChatOrderedListHover'),u=b('ChatQuietLinks'),v=b('ChatSidebarThreadlist.react'),w=b('ChatTypeaheadConstants'),x=b('ChatUnreadCount'),y=b('ChatVisibility'),z=b('CSS'),aa=b('DataStore'),ba=b('DOM'),ca=b('Ease'),da=b('Event'),ea=b('ImageSourceRequest'),fa=b('ImageSourceType'),ga=b('JSLogger'),ha=b('JSXDOM'),ia=b('LastMobileActiveTimes'),ja=b('MercuryParticipantTypes'),ka=b('OrderedFriendsList'),la=b('Parent'),ma=b('PhotoResizeModeConst'),na=b('PresencePrivacy'),oa=b('PresenceStatus'),pa=b('React'),qa=b('Rect'),ra=b('ShortProfiles'),sa=b('Style'),ta=b('TokenizeUtil'),ua=b('Tooltip'),va=b('URI'),wa=b('Vector'),xa=b('XHPTemplate'),ya=b('copyProperties'),za=b('createObjectFrom'),ab=b('csx'),bb=b('cx'),cb=b('debounceAcrossTransitions'),db=b('guid'),eb=b('ix'),fb=b('requestAnimationFrame'),gb=b('runAfterScrollingStops'),hb=b('shield'),ib=b('throttle'),jb=b('tx'),kb=b("mixin"),lb=b('ChannelImplementation').instance,mb=p.get('chat_ranked_by_coefficient',0),nb=null,ob,pb,qb=9,rb=kb(i);for(var sb in rb)if(rb.hasOwnProperty(sb))ub[sb]=rb[sb];var tb=rb===null?null:rb.prototype;ub.prototype=Object.create(tb);ub.prototype.constructor=ub;ub.__superConstructor__=rb;function ub(bc,cc,dc,ec,fc,gc){"use strict";this._isSidebar=bc;this._isLitestand=p.get('litestand',0)||p.get('test_litestand_sidebar',0);this._isLitestandSidebar=this._isSidebar&&this._isLitestand;this._isLeftCollapsedSidebar=!!la.byClass(cc,"_5ap0");this._root=cc;this._itemsMap={};this._isVisible=false;this._excludedIds={};this._numTopFriends=5;this._hasRendered=false;this._preventRendering=false;this._hoverController=null;this._template=dc;this._messageTemplate=ec;this._favoriteMode=p.get('divebar_favorite_list',0);this._contextualDialog=fc;this._cachedItemHeight=null;this._cachedItemPadding=null;if(gc&&ba.scry(gc,"._54y_").length){z.show(gc);this._pymk=gc;}this._usePlaceholder=this._isLitestand&&this._isSidebar;if(p.get('groups_in_divebar')){this._groupThreadsNode=ha.li({className:"_56yf"});this._updateGroupThreads();this._groupsList=this._favoriteMode&&ba.find(this._root,"._56yh");}if(this._favoriteMode){this._favoriteSidebar=ba.find(this._root,"._42g5");this._editButton=ba.scry(this._root,"._57m9 ._54sl")[0];this._favoriteList=ba.find(this._root,"._54sm");this._activeNowList=ba.find(this._root,"._54sn");this._activeNowLabel=ba.scry(this._root,"._42g9")[0];if(this._activeNowLabel)this._activeNowArea=la.byClass(this._activeNowLabel,"_57yh");}this._orderedList=ba.find(this._root,'.fbChatOrderedList');this._scrollableOrderedList=la.byClass(this._root,'scrollableOrderedList');this._chatSidebar=la.byClass(this._root,'fbChatSidebar');this._scrollableArea=la.byClass(this._root,'scrollable');da.listen(this._root,'click',this._onClick.bind(this));da.listen(this._root,'mouseenter',this._mouseEnter.bind(this));da.listen(this._root,'mouseleave',this._mouseLeave.bind(this));if(this._editButton){da.listen(this._editButton,'click',this.toggleEditMode.bind(this));h.subscribe(['LitestandSidebarBookmarks/close','LitestandSidebar/collapse'],this._onEditEnd.bind(this));}h.subscribe(['LitestandSidebar/collapse','LitestandSidebar/expand'],function(event){if(this._isLitestandSidebar)this.getHoverController().setPaused(event==='LitestandSidebar/collapse');this.render();}.bind(this));l.subscribe(m.ON_AVAILABILITY_CHANGED,hb(this.update,this));na.subscribe('privacy-changed',hb(this.update,this));lb.subscribe([lb.CONNECTED,lb.RECONNECTING,lb.SHUTDOWN,lb.MUTE_WARNING,lb.UNMUTE_WARNING],hb(this.update,this));this.inform('initialized',this,h.BEHAVIOR_PERSISTENT);this.render();h.subscribe(ga.DUMP_EVENT,function(hc,ic){ic.chat_lists=ic.chat_lists||{sorted_list:this.getCachedSortedList(),ordered_list:ka.getList(),available_list:ub.getAvailableList(this._excludedIds),excluded_list:this._excludedIds};}.bind(this));h.subscribe('ChatOrderedList/itemHeightChange',function(){this._cachedItemHeight=null;this._cachedItemPadding=null;}.bind(this));this._renderUnreadCount=p.get('divebar_message_count');if(this._renderUnreadCount)x.subscribe('unread-changed',function(hc,ic){if(!this._renderedTopUsers||!(ic in this._renderedTopUsers)||!this._itemsMap[ic])return;x.getUnreadCountForUID(ic,this._updateUnreadCount.bind(this,ic));}.bind(this));}ub.prototype.getAllNodes=function(){"use strict";var bc={},cc=ba.scry(this._root,"li._42fz");for(var dc=0;dc<cc.length;dc++){var ec=aa.get(cc[dc],'id');if(ec)bc[ec]=cc[dc];}return bc;};ub.prototype.getShowingUsers=function(){"use strict";return ba.scry(this._root,"li._42fz,li._5a58").map(this.getUserForNode);};ub.prototype.getUserForNode=function(bc){"use strict";return aa.get(bc,'id')||aa.get(bc,'serverthreadid');};ub.prototype.getHoverController=function(){"use strict";if(!this._hoverController){this._hoverController=new t(this,this._contextualDialog);if(this._isLitestandSidebar&&this._isLitestandSidebarCollapsed())this._hoverController.setPaused(true);}return this._hoverController;};ub.prototype._isLitestandSidebarCollapsed=function(){"use strict";if(this._isLeftCollapsedSidebar)return true;if(ob)return !ob.isExpanded();n.loadModules(['LitestandSidebar'],function(bc){ob=bc;});return z.hasClass(document.documentElement,"_4kdq");};ub.prototype.getPaddingOffset=function(){"use strict";return this._favoriteMode?24:8;};ub.prototype._calculateItemMeasurements=function(){"use strict";var bc=this._orderedList,cc=this._template.build(),dc=cc.getRoot();ba.setContent(cc.getNode('name'),'test');if(this._favoriteSidebar){bc=this._favoriteList;z.addClass(this._favoriteSidebar,"_4zmr");}dc.style.visibility='hidden';ba.appendContent(bc,dc);this._cachedItemHeight=wa.getElementDimensions(dc).y;this._cachedItemPadding=sa.getFloat(cc.getNode('anchor'),'padding')||0;ba.remove(dc);if(this._favoriteSidebar)z.removeClass(this._favoriteSidebar,"_4zmr");};ub.prototype.getItemHeight=function(){"use strict";if(this._cachedItemHeight===null)this._calculateItemMeasurements();return this._cachedItemHeight;};ub.prototype.getItemPadding=function(){"use strict";if(this._cachedItemPadding===null)this._calculateItemMeasurements();return this._cachedItemPadding;};ub.prototype._updateGroupThreads=function(){"use strict";if(this._groupThreadsNode){var bc=na.getVisibility(),cc=v({offlineItems:lb.disconnected()||!bc,litestandSidebar:this._isSidebar&&this._isLitestand&&!p.get('test_old_divebar')});pa.renderComponent(cc,this._groupThreadsNode);}};ub.prototype._placeholderUpdate=function(){"use strict";if(!this._usePlaceholder||!this._scrollContainer)return;var bc=this._root.offsetTop-this._scrollContainer.scrollTop;this._scrollContainerHeight=this._scrollContainerHeight||this._scrollContainer.offsetHeight;var cc=this.getItemHeight(),dc=Math.ceil(this._scrollContainerHeight/cc),ec=bc<0?Math.max(Math.floor(-bc/cc)-dc,0):0,fc=ec+dc+dc;this._cachedItems=this._cachedItems||ba.scry(this._root,"li._42fz");for(var gc=0,hc=this._cachedItems.length;gc<hc;gc++)z.conditionClass(this._cachedItems[gc],"_50zv",gc<ec||gc>fc);};ub.prototype._getListItem=function(bc,cc){"use strict";var dc=this._itemsMap[bc];if(!dc)return;var ec=oa.get(bc),fc=oa.isBirthday(bc),gc=na.allows(bc)&&!lb.disconnected();if(dc.buttonNode===undefined){dc.buttonNode=ba.scry(dc.node,"._54sk")[0];dc.contextNode=ba.find(dc.node,"._52zk");dc.timeNode=ba.scry(dc.node,'.active_time')[0];dc.statusNodes=ba.scry(dc.node,'img.status');}z.conditionClass(dc.node,"_42f-",cc);z.conditionClass(dc.node,"_54sj",cc);z.conditionClass(dc.node,"_52s3",this._isLitestand&&cc);if(dc.buttonNode)if(!this._isLitestand){z.conditionClass(dc.buttonNode,"_42f_",cc);z.conditionClass(dc.buttonNode,"_42g0",!cc);}var hc={active:false,mobile:false,birthday:false};hc.active=ec===m.ACTIVE;hc.mobile=ec===m.MOBILE;hc.birthday=fc;if(hc.mobile){var ic=ia.getShortDisplay(bc);if(dc.timeNode&&dc.lastActiveTime!==ic){dc.lastActiveTime=ic;ba.setContent(dc.timeNode,ic);}}else if(dc.lastActiveTime){dc.lastActiveTime=null;ba.empty(dc.timeNode);}for(var jc in hc)z.conditionClass(dc.node,jc,hc[jc]&&gc);z.conditionClass(dc.node,'invis',!gc);var kc=z.hasClass(document.documentElement,'highContrast');dc.statusNodes.forEach(function(lc){if(ec===m.ACTIVE&&gc){lc.alt="Online";if(kc)lc.src=eb('/images/chat/status/online.png');}else if(ec===m.MOBILE&&gc){lc.alt="Cellulare";if(kc)lc.src=eb('/images/chat/status/mobile.png');}else{lc.alt='';if(kc)lc.src=eb('/images/spacer.gif');}});this._applyContext(bc,dc);return dc.node;};ub.prototype.getRoot=function(){"use strict";return this._root;};ub.prototype.getSortedList=function(bc){"use strict";return ub.getSortedList(bc||this._excludedIds,this._numTopFriends);};ub.prototype.getCachedSortedList=function(bc){"use strict";if(nb==null)nb=this.getSortedList(bc);return nb;};ub.prototype.toggleFavoriteSidebar=function(bc,cc){"use strict";function dc(gc,hc){z.conditionShow(hc,gc);var ic=la.byClass(hc,'uiContextualLayerPositioner');ic&&z.conditionShow(ic,gc);}z.conditionShow(this._orderedList,!bc);if(this._favoriteSidebar)z.conditionShow(this._favoriteSidebar,bc);var ec=ba.scry(this._scrollableOrderedList||this._root,"._42i3");ec.forEach(dc.curry(bc));var fc=ba.scry(this._scrollableOrderedList||this._root,"._56yi");fc.length&&dc(cc,fc[0]);};ub.prototype.hide=function(){"use strict";if(!this._isVisible)return;this._isVisible=false;z.hide(this._scrollableOrderedList||this._root);this.inform('hide');};ub.prototype._onFavoriteOrderChange=function(){"use strict";var bc=this.sortableGroup.getOrder();r.updateList(bc);r.save();};ub.prototype._getFavoriteItems=function(){"use strict";var bc=[],cc=r.get();for(var dc=0;dc<cc.length;dc++){var ec=this._itemsMap[cc[dc]];if(ec)bc.push(ec.node);}return bc;};ub.prototype._getChatTabOpenLogData=function(bc){"use strict";var cc=z.hasClass(document.documentElement,'sidebarMode'),dc={mode:cc?'sidebar':'chatNub',typehead:false};if(this._scrollableArea&&this._scrollContainer){var ec=wa.getElementPosition(this._scrollableArea,'viewport').y,fc=wa.getElementPosition(bc,'viewport').y,gc=this._scrollContainer.scrollTop;if(fc>ec){dc.visible_slot=Math.round((fc-ec)/32);var hc=Math.round(gc/32);dc.global_slot=dc.visible_slot+hc;}}if(cc){dc.sidebar_height=this._chatSidebar&&this._chatSidebar.clientHeight;if(this._scrollContainer)dc.buddylist_height=this._scrollContainer.clientHeight;}return dc;};ub.prototype._resetFavoriteBounds=function(){"use strict";var bc=r.get(),cc=bc.length;if(cc){var dc=bc[0],ec=bc[cc-1],fc=this._itemsMap[dc],gc=this._itemsMap[ec],hc=new qa(wa.getElementPosition(fc.node).y,0,wa.getElementPosition(gc.node).y+wa.getElementDimensions(gc.node).y,0);this.sortableGroup.setBoundingBox(hc);}};ub.prototype._createSortableGroup=function(){"use strict";if(this.sortableGroup)this.sortableGroup.destroy();n.loadModules(['SortableGroup'],function(bc){this.sortableGroup=new bc().setBeforeGrabCallback(this._resetFavoriteBounds.bind(this)).setOrderChangeHandler(this._onFavoriteOrderChange.bind(this));if(this._isLitestand)this.sortableGroup.gutter=1;var cc=this._getFavoriteItems();for(var dc=0;dc<cc.length;dc++){var ec=cc[dc];this.sortableGroup.addSortable(aa.get(ec,'id'),ec);}}.bind(this));};ub.prototype.toggleEditMode=function(){"use strict";r.toggleEditMode();if(r.isEditMode()){this._createSortableGroup();ba.setContent(this._editButton,"Fine");z.addClass(this._favoriteSidebar,"_4-d6");this.inform('editStart');}else this._onEditEnd();};ub.prototype._onEditEnd=function(){"use strict";if(r.isEditMode())r.toggleEditMode();ba.setContent(this._editButton,"Modifica");z.removeClass(this._favoriteSidebar,"_4-d6");this.inform('editEnd');};ub.prototype._onClick=function(event){"use strict";var bc=event.getTarget(),cc=la.byTag(bc,'li');if(r.isEditMode()){var dc=la.byClass(bc,"_54sk");if(dc&&cc){var ec=aa.get(cc,'id');if(ec){r.toggleID(ec);r.save();}this.update();}event.prevent();return false;}if(cc){if(z.hasClass(cc,'blackbirdWhitelist')){var fc=new va('/ajax/chat/privacy/settings_dialog.php').addQueryData({ref:'whitelist_separator'});j.send(new k(fc));event.prevent();return false;}var gc=aa.get(cc,'id'),hc=z.hasClass(cc,"_56yg");if(gc||hc){var ic=this._getChatTabOpenLogData(cc),jc=z.hasClass(document.documentElement,'sidebarMode'),kc=na.getOnlinePolicy()===na.ONLINE_TO_WHITELIST,lc=kc?'white_list':'ordered_list';if(hc){gc=cc.getAttribute('data-threadid');lc=gc?'recent_threads_in_divebar':'recent_threads_in_divebar_new';}else if(jc&&this._favoriteMode&&!kc){while(cc.parentNode){cc=cc.parentNode;if(z.hasClass(cc,"_42g8")){lc='more_online_friends';break;}if(z.hasClass(cc,"_42g7"))break;}}else while(cc.previousSibling){cc=cc.previousSibling;if(z.hasClass(cc,"_554m")){if(z.hasClass(cc,'moreOnlineFriends')){lc='more_online_friends';break;}if(z.hasClass(cc,'blackbirdWhitelist')){lc='blackbird_offline_section';break;}}}ic.source=lc;var mc=hc?w.THREAD_TYPE:ja.FRIEND;o.openTab(gc,mc,ic);this.inform('click',{id:gc});}else if(z.hasClass(cc,"_554m")&&la.byClass(bc,"_554n")){this.scrollTo(cc);}else if(z.hasClass(cc,"_55nf"))return;return false;}};ub.prototype._mouseEnter=function(){"use strict";this._preventRendering=true;};ub.prototype._mouseLeave=function(){"use strict";this._preventRendering=false;};ub.prototype.setExcludedIds=function(bc){"use strict";this._excludedIds=za(bc||[]);};ub.prototype.setNumTopFriends=function(bc){"use strict";if(bc!==this._numTopFriends){this._numTopFriends=bc;this.render();}};ub.prototype._getOfflineToSectionItems=function(){"use strict";var bc='subheader-text-'+db(),cc=ba.create('a',{href:'#','aria-describedby':bc},ba.tx._("Modifica")),dc=[],ec=ba.tx._("ALTRI AMICI");dc.push(ha.li({className:"_554m"},ha.div({className:"_554o"},ha.div({className:"_554n"},ha.span({className:"_554p"},ec),ha.div({className:"_554q"},ha.span({className:"_554r"}))))));dc.push(ha.li({className:"_554m blackbirdWhitelist"},ha.div({className:"_554o"},ha.div({className:"fbChatOrderedList/separatorInner"},ha.div({className:"fbChatOrderedList/separatorSubheader"},ha.span({id:bc,className:"_554t"},jb._("Per questi amici non sei visibile in chat. {=link}",{'=link':cc})))))));return dc;};ub.prototype._renderOrderedList=function(){"use strict";if(!this._isVisible||(this._preventRendering&&this._hasRendered)||pb)return;this._hasRendered=true;this._cachedItems=null;var bc=[],cc,dc,ec=false,fc=false,gc=z.hasClass(document.documentElement,'sidebarMode'),hc=na.getVisibility(),ic=na.getOnlinePolicy()===na.ONLINE_TO_WHITELIST,jc=this._isLitestandSidebar&&this._isLitestandSidebarCollapsed(),kc=p.get('groups_in_divebar');kc&&this._updateGroupThreads();var lc=kc&&s.getThreadIDs().length,mc=gc&&this._favoriteMode&&hc&&!ic;if(mc&&kc&&lc&&this._groupThreadsNode){ba.setContent(this._groupsList,this._groupThreadsNode);u.nukeLinks(this._groupThreadsNode);u.nukeLinks(this._favoriteList);this.inform('render');}var nc=mc&&this._groupThreadsNode&&this._groupsList,oc=nc&&lc,pc=this._isLitestand&&!la.byClass(this._root,"_4w59");if(nc&&(lc||pc)){ba.setContent(this._groupsList,this._groupThreadsNode);z.show(this._groupsList);u.nukeLinks(this._favoriteList);this.inform('render');}else this._groupsList&&z.hide(this._groupsList);var qc=lc||0;if(oc||!mc)qc++;var rc=[],sc,tc;if(mc){this._chatSidebar&&z.addClass(this._chatSidebar,'fbSidebarFavoriteList');rc=r.get();if(jc)rc=rc.slice(0,Math.max(0,this._numTopFriends-qc));for(sc=0,tc=rc.length;sc<tc;sc++){cc=rc[sc];dc=this._getListItem(cc,true);if(dc){bc.push(dc);}else{fc=true;this._renderListItem(cc,this.update.bind(this));}}}this.toggleFavoriteSidebar(mc,oc);var uc=jc?1:0,vc=ub.getSortedList(za(rc),Math.max(0,this._numTopFriends-rc.length-qc+uc));if(mc){if(rc.length&&vc.length){var wc=ba.create('li',{className:"_42g3"});bc.push(wc);}}else if(lc)this._groupThreadsNode&&bc.push(this._groupThreadsNode);var xc=na.getVisibility()&&na.getOnlinePolicy()==na.ONLINE_TO_WHITELIST;for(var yc=0,zc=vc.length;yc<zc;yc++){cc=vc[yc];if(xc)if(!na.allows(cc)){if(yc+2>=vc.length)break;xc=false;var ad=this._getOfflineToSectionItems();bc.push(ad[0]);bc.push(ad[1]);zc-=2;}dc=this._getListItem(cc);if(dc){bc.push(dc);}else this._renderListItem(cc,this.render.bind(this));}if(mc){ba.setContent(this._favoriteList,bc);if(bc.length)u.nukeLinks(this._favoriteList);this.inform('render');}var bd;if(jc){bd=[];}else bd=ub.getAvailableList(this._excludedIds);var cd=rc.concat(vc),dd=za(cd);bd=bd.filter(function(md){return !(md in dd);});if(this._renderUnreadCount){var ed=[];if(this._renderedTopUsers){var fd=Object.keys(this._renderedTopUsers).filter(function(md){return !(md in dd);});fd.forEach(function(md){this._updateUnreadCount(md,0);}.bind(this));cd.forEach(function(md){if(!(md in this._renderedTopUsers))ed.push(md);}.bind(this));}else ed=cd;var gd=this._updateUnreadCount.bind(this);ed.forEach(function(md){x.getUnreadCountForUID(md,function(nd){gd(md,nd);});});this._renderedTopUsers=dd;}if(p.get('divebar_show_mobile_more_friends_alphabetical')){bd.sort(zb);}else bd.sort(ac);var hd="ALTRI AMICI";if(mc){bc=[];}else if(bd.length&&bc.length){var id;if(this._isLitestand){id=ha.span(null,ha.span({className:"_554u"},hd,"  ",bd.length),ha.span({className:"_554v"}," +",bd.length));}else id=jb._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':hd,'=count':bd.length});if(this._pymk){ec=true;bc.push(this._pymk);}bc.push(ha.li({className:"_554m moreOnlineFriends"},ha.div({className:"_554o"},ha.div({className:"_554n"},ha.span({className:"_554p"},id),ha.div({className:"_554q"},ha.span({className:"_554r"}))))));}for(sc=0,tc=bd.length;sc<tc;sc++){cc=bd[sc];dc=this._getListItem(cc);if(dc){bc.push(dc);}else this._renderListItem(cc,this.render.bind(this));}if(!vc.length&&!bd.length&&!qc){var jd=this._messageTemplate.render(),kd=xa.getNode(jd,'message');ba.setContent(kd,"Nessuno \u00e8 disponibile a chattare.");bc.push(jd);}if(bc.length){if(mc){z.show(this._activeNowList);if(this._activeNowLabel){var ld;z.show(this._activeNowArea);if(this._isLitestand){ld=ha.span(null,ha.span({className:"_554u"},hd,"  ",bd.length),ha.span({className:"_554v"}," +",bd.length));}else ld=jb._("{MORE ONLINE FRIENDS} ({=count})",{'MORE ONLINE FRIENDS':"Amici attivi ora",'=count':bd.length});ba.setContent(this._activeNowLabel,ld);}ba.setContent(this._activeNowList,bc);u.nukeLinks(this._activeNowList);}else{if(this._pymk&&!ec)bc.push(this._pymk);ba.setContent(this._orderedList,bc);if(this._pymk){u.removeMessagesHrefs(this.getRoot());}else u.nukeLinks(this.getRoot());}this.inform('render');this._placeholderUpdate();if(!this._renderingAfterScroll){this._renderingAfterScroll=true;this.render=cb(gb.curry(this._renderOrderedList.bind(this),'ChatOrderedList/render',true),300);}}else if(mc){z.hide(this._activeNowList);if(this._activeNowArea)z.hide(this._activeNowArea);}if(mc&&!fc)if(r.isEditMode()&&r.hasChanged())this._createSortableGroup();};ub.prototype.render=function(){"use strict";this.render=cb(this._renderOrderedList.bind(this),300);this.render();};ub.prototype._renderListItem=function(bc,cc){"use strict";ra.get(bc,function(dc){var ec=this._template.render(),fc=xa.getNode(ec,'profile-photo');if(p.get('chat_use_client_side_image_requests',0)){var gc=this._isLitestand?24:28;new ea().setFBID(dc.id).setType(fa.PROFILE_PICTURE).setDimensions(gc,gc).setResizeMode(ma.COVER).setCallback(function(lc){fc.setAttribute('src',lc.uri);}).send();}else fc.setAttribute('src',dc.thumbSrc);var hc=xa.getNode(ec,'name');ba.setContent(hc,dc.name);var ic=xa.getNode(ec,'accessible-name');ba.setContent(ic,dc.name);var jc=xa.getNode(ec,'anchor');jc.setAttribute('href','/messages/'+bc);var kc=xa.getNode(ec,'tooltip');kc&&ua.set(kc,dc.name,'right');aa.set(ec,'id',bc);this._itemsMap[bc]={node:ec};cc&&cc(ec);}.bind(this));};ub.prototype._updateUnreadCount=function(bc,cc){"use strict";var dc=this._itemsMap[bc];if(!dc)return;if(this._isSidebar){this._unreadMessages=this._unreadMessages||{};if(!!cc){this._unreadMessages[bc]=true;}else delete this._unreadMessages[bc];h.inform('buddylist-nub/updateCount',{count:Object.keys(this._unreadMessages).length});}dc.unreadCount=dc.unreadCount||ba.find(dc.node,"._550_");cc=cc?cc:0;ba.setContent(dc.unreadCount,cc>qb?qb+'+':cc);z.conditionClass(dc.unreadCount,"_550z",cc>qb);z.conditionClass(dc.node,"_550-",cc);};ub.prototype.show=function(){"use strict";if(this._isVisible)return;this._isVisible=true;z.show(this._scrollableOrderedList||this._root);this.render();this.inform('show');};ub.prototype.isVisible=function(){"use strict";return this._isVisible;};ub.prototype.update=function(){"use strict";this._hasRendered=false;if(!this._renderRequest)this._renderRequest=fb(function(){this.render();this._renderRequest=null;}.bind(this));};ub.prototype.setScrollContainer=function(bc){"use strict";if(ba.contains(bc,this._root)){this._scrollContainer=bc;if(this._usePlaceholder){da.listen(bc,'scroll',ib.acrossTransitions(this._placeholderUpdate.bind(this)));da.listen(window,'resize',ib.acrossTransitions(function(){this._scrollContainerHeight=null;this._placeholderUpdate();}.bind(this),250));}}};ub.prototype.scrollTo=function(bc){"use strict";if(!this._scrollContainer)return;var cc=this._scrollContainer.scrollHeight,dc=this._scrollContainer.clientHeight,ec=this._scrollContainer.scrollTop,fc=Math.min(bc.offsetTop,cc-dc);if(ec!==fc){var gc=this._isLitestand?600:Math.abs(fc-ec)/this._scrollContainer.clientHeight*500,hc=this._isLitestand?ca.easeOutExpo:g.ease.end;new g(this._scrollContainer).to('scrollTop',fc).ease(hc).duration(gc).go();}};ub.prototype._applyContext=function(bc,cc){"use strict";var dc=q.getShortDisplay(bc)||'';if(cc.contextNode){ba.setContent(cc.contextNode,dc);z.conditionClass(cc.node,"_52zj",dc);var ec=q.get(bc),fc=ec?ec.type:null;for(var gc in ub.CONTEXT_CLASSES){var hc=(gc===fc),ic=ub.CONTEXT_CLASSES[gc]||"_56x-";z.conditionClass(cc.contextNode,ic,hc);}}};ub.getSortedList=function(bc,cc){"use strict";var dc=ka.getList().filter(function(gc){return !(gc in bc)&&na.getFriendVisibility(gc)!==na.BLACKLISTED;}),ec=[];if(!y.isOnline()){Array.prototype.push.apply(ec,dc);}else{if(na.getOnlinePolicy()===na.ONLINE_TO_WHITELIST)dc=this._filterByWhitelist(dc);if(p.get('chat_web_ranking_with_presence')){Array.prototype.push.apply(ec,dc);}else ec=this._splitOutTopFriends(dc,cc);}ec=ec.slice(0,cc);if(ec.length===cc){var fc=ub.getAvailableList(ec.concat(bc)).length;fc&&ec.splice(-1);}if(!p.get('chat_web_ranking_with_presence'))ec.sort(vb);nb=ec.slice();return ec;};ub._filterByWhitelist=function(bc){"use strict";var cc=bc,dc={},ec,fc;bc=[];for(ec=0;ec<cc.length;++ec){fc=cc[ec];if(na.allows(fc)){dc[fc]=true;bc.push(fc);}}var gc=na.getWhitelist();for(ec=0;ec<gc.length;++ec){fc=gc[ec];if(!(fc in dc))bc.push(fc);}for(ec=0;ec<cc.length;++ec){fc=cc[ec];if(!na.allows(fc))bc.push(fc);}return bc;};ub._splitOutTopFriends=function(bc,cc){"use strict";var dc=[],ec=[],fc=p.get('ordered_list.top_friends',0),gc=p.get('ordered_list.top_mobile',0),hc=cc,ic=bc.length;for(var jc=0;jc<ic&&hc>0;jc++){var kc=bc[jc],lc=oa.get(kc),mc=lc===m.ACTIVE;if(mc||(lc===m.MOBILE&&jc<gc)||jc<fc){dc.push(kc);mc&&hc--;}else ec.push(kc);}if(jc<ic)Array.prototype.push.apply(ec,bc.slice(jc));if(dc.length<cc)Array.prototype.push.apply(dc,ec);return dc;};ub.getAvailableList=function(bc){"use strict";var cc;if(p.get('divebar_show_mobile_more_friends')||p.get('divebar_show_mobile_more_friends_alphabetical'))cc=l.getAvailableIDs();if(!cc)cc=l.getOnlineIDs();return cc.filter(function(dc){return !(dc in bc);});};ub._pause=function(){"use strict";pb=true;};ub._unpause=function(){"use strict";pb=false;};ub._registerToggleRenderItem=function(bc){"use strict";da.listen(bc,'click',function(){pb=!pb;z.conditionClass(bc,'checked',pb);});};function vb(bc,cc){var dc=wb(bc,cc);if(dc!==0)return dc;if(!mb){var ec=zb(bc,cc);if(ec!==0)return ec;}return ka.compare(bc,cc);}function wb(bc,cc){var dc=na.allows(bc),ec=na.allows(cc);if(dc!==ec)return dc?-1:1;return 0;}var xb={};function yb(bc){return xb[bc]||(xb[bc]=ta.flatten(bc));}function zb(bc,cc){var dc=ra.getNowUnsafe(bc),ec=ra.getNowUnsafe(cc),fc=yb((dc||{}).name||'~'),gc=yb((ec||{}).name||'~');if(fc!==gc)return fc<gc?-1:1;return 0;}function ac(bc,cc){var dc=oa.get(bc)===m.MOBILE,ec=oa.get(cc)===m.MOBILE;if(dc!==ec)return ec?-1:1;return zb(bc,cc);}ya(ub,{CONTEXT_CLASSES:{nearby:"_56xw",visiting:"_56xx",neighbourhood:"_56xy",listening:"_56xz"}});e.exports=ub;});
__d("ChatTypeaheadBehavior",["Chat","ChatConfig","ChatFavoriteList","CSS","DOM","Parent","Rect","copyProperties","cx","tx"],function(a,b,c,d,e,f){var g=b('Chat'),h=b('ChatConfig'),i=b('ChatFavoriteList'),j=b('CSS'),k=b('DOM'),l=b('Parent'),m=b('Rect'),n=b('copyProperties'),o=b('cx'),p=b('tx');function q(s,t){if(!h.get('litestand_classic_sidebar'))return;var u=l.byClass(s,"_4oes");if(u)j.conditionClass(u,"_5q83",t);}function r(s){"use strict";this._typeahead=s;}r.prototype.enable=function(){"use strict";var s=this._typeahead;this._subscriptions=[s.subscribe('focus',function(){s.getData().refreshData();q(s.getElement(),true);}),s.subscribe('blur',function(t){s.getCore().reset();q(s.getElement(),false);}),s.subscribe('respond',function(t,u){if(u.value&&u.value===s.getCore().getValue()){if(!u.results.length){var v=h.get('divebar_typeahead_group_fof',0);if(v&&!u.isAsync)return;var w=k.create('div',{className:'noResults'},"Amico non trovato.");k.setContent(s.getView().getElement(),w);}j.addClass(s.getElement(),'hasValue');}}),s.subscribe('reset',function(){j.removeClass(s.getElement(),'hasValue');}),s.subscribe('select',function(t,u){s.getView().hide();if(i.isEditMode()){i.toggleID(u.selected.uid);i.save();}else{var v=j.hasClass(document.documentElement,'sidebarMode'),w={mode:v?'sidebar':'chatNub',source:'typeahead',type:u.selected.type,typeahead:true};g.openTab(u.selected.uid,u.selected.type,w);}}),s.subscribe('highlight',function(t,u){if(u.index>=0){var v=s.getView().getItems()[u.index];if(v){var w=new m(v),x=v.offsetParent,y=w.boundWithin(new m(x)).getPositionVector();w.getPositionVector().sub(y).scrollElementBy(x);}}})];};r.prototype.disable=function(){"use strict";this._subscriptions.forEach(function(s){this._typeahead.unsubscribe(s);}.bind(this));this._subscriptions=null;};n(r.prototype,{_subscriptions:null});e.exports=r;});
__d("ChatTypeaheadCore",["function-extensions","Event","Keys","TypeaheadCore","copyProperties","emptyFunction","shield"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Event'),h=b('Keys'),i=b('TypeaheadCore'),j=b('copyProperties'),k=b('emptyFunction'),l=b('shield');for(var m in i)if(i.hasOwnProperty(m))o[m]=i[m];var n=i===null?null:i.prototype;o.prototype=Object.create(n);o.prototype.constructor=o;o.__superConstructor__=i;function o(){"use strict";if(i!==null)i.apply(this,arguments);}o.prototype.init=function(p,q,r){"use strict";n.init.call(this,p,q,r);this.informBeginActive=false;this.informEndActive=false;this.data.subscribe('respond',function(){if(this.informBeginActive){this.informBeginActive=false;this.inform('sidebar/typeahead/active',true);}else if(this.informEndActive){this.informEndActive=false;this.inform('sidebar/typeahead/active',false);}}.bind(this));};o.prototype.keydown=function(event){"use strict";var p=g.getKeyCode(event);if(p===h.ESC){l(this.reset,this).defer();if(!this.getValue()){this.element.blur();this.inform('escape');}return event.kill();}return n.keydown.call(this,event);};o.prototype.checkValue=function(){"use strict";var p=this.getValue(),q=this.value;if(p==q)return;if(q&&!p){this.typeaheadActive=false;this.informEndActive=true;}else if(!q&&p){this.typeaheadActive=true;this.informBeginActive=true;this.inform('sidebar/typeahead/preActive');}n.checkValue.call(this);};j(o.prototype,{handleTab:k});e.exports=o;});
__d("ChatTypeaheadDataSource",["DataSource","Env","JSLogger","MercuryParticipantTypes","OrderedFriendsList","Run","ShortProfiles"],function(a,b,c,d,e,f){var g=b('DataSource'),h=b('Env'),i=b('JSLogger'),j=b('MercuryParticipantTypes'),k=b('OrderedFriendsList'),l=b('Run'),m=b('ShortProfiles');for(var n in g)if(g.hasOwnProperty(n))p[n]=g[n];var o=g===null?null:g.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=g;function p(q){"use strict";q=q||{};q.kanaNormalization=true;g.call(this,q);this.persistOnRefresh=q.persistOnRefresh!==false;this.showOfflineUsers=!!q.showOfflineUsers;this._jslog=i.create('chat_typeahead');this._jslog.log('created');}p.prototype.init=function(){"use strict";this._jslog.log('init');o.init.call(this);this._update();};p.prototype.bootstrap=function(){"use strict";this._jslog.log('bootstrap');o.bootstrap.call(this);if(this.showOfflineUsers){this._jslog.log('show_offline_users');this._jslog.log('ensured_short_profiles');if(m.hasAll()){this._update();}else{this._jslog.log('fetch_all_short_profiles');m.fetchAll();this.inform('activity',{activity:true});var q=m.subscribe('updated',function(){this.inform('activity',{activity:false});this._update();}.bind(this));if(!this.persistOnRefresh)l.onLeave(function(){m.unsubscribe(q);});}}};p.prototype._update=function(){"use strict";d(['AvailableList'],function(q){var r=this.value;this.dirty();var s=m.getCachedProfileIDs(),t=s.filter(function(v){var w=m.getNow(v);return w.type===j.FRIEND;});t.sort(k.compare);var u=[];t.forEach(function(v){if(v==h.user)return;var w=q.get(v);if(!this.showOfflineUsers&&w!==q.ACTIVE)return;var x=m.getNow(v),y=x.additionalName;if(x.hasOwnProperty('searchTokens'))y=y!==null?y+" "+x.searchTokens.join(" "):x.searchTokens.join(" ");u.push({uid:v,text:x.name,tokens:y,localized_text:x.name,additional_text:x.additionalName,photo:x.thumbSrc,type:x.type});}.bind(this));if(u.length)this.addEntries(u);this.value=r;if(r)this.query(r);}.bind(this));};p.prototype.refreshData=function(){"use strict";d(['AvailableList'],function(q){q.update();}.bind(this));};e.exports=p;});
__d("ChatTypeaheadView",["BucketedTypeaheadView","ChatConfig","ChatTypeaheadConstants","Env","MercuryThreadSearchUtils","arrayContains","fbt","tx"],function(a,b,c,d,e,f){var g=b('BucketedTypeaheadView'),h=b('ChatConfig'),i=b('ChatTypeaheadConstants'),j=b('Env'),k=b('MercuryThreadSearchUtils'),l=b('arrayContains'),m=b('fbt'),n=b('tx'),o=h.get('divebar_typeahead_group_fof',0);for(var p in g)if(g.hasOwnProperty(p))r[p]=g[p];var q=g===null?null:g.prototype;r.prototype=Object.create(q);r.prototype.constructor=r;r.__superConstructor__=g;function r(s,t){"use strict";g.call(this,s,t);this.typeObjects={};this.typeObjectsOrder=[];this.typeObjects[i.NON_FRIEND_TYPE]={uid:i.NON_FRIEND_TYPE,type:i.HEADER_TYPE,text:"AMICI DI AMICI"};this.typeObjectsOrder.push(i.NON_FRIEND_TYPE);this.typeObjects[i.THREAD_TYPE]={uid:i.THREAD_TYPE,type:i.HEADER_TYPE,text:"CONVERSAZIONI DI GRUPPO"};this.typeObjectsOrder.push(i.THREAD_TYPE);this.typeObjects[i.FB4C_TYPE]={uid:i.FB4C_TYPE,type:i.HEADER_TYPE,text:"COLLEGHI"};this.typeObjectsOrder.push(i.FB4C_TYPE);this.typeObjects[i.FRIEND_TYPE]={disabled:true,uid:i.FRIEND_TYPE,type:i.HEADER_TYPE,text:"Amici"};this.typeObjectsOrder.push(i.FRIEND_TYPE);}r.prototype.buildBuckets=function(s,t){"use strict";if(o){t=t.reverse();t=t.filter(function(u){var v=u.render_type||u.type;if(v==='thread'){var w='fbid:'+j.user;if(!l(u.mercury_thread.participants,w))return false;var x=u.participants_to_render.some(function(z){return k.queryMatchesName(s,z.name);}),y=k.queryMatchesName(s,u.mercury_thread.name);if(!x&&!y)return false;}return true;});}t=q.buildBuckets.call(this,s,t);if(!o)t=t.filter(function(u){return u&&!u.disabled;});return t;};r.prototype.getDefaultIndex=function(s){"use strict";if(!o)return q.getDefaultIndex.call(this,s);if(s.length===0)return -1;var t=s.length-1;while(!this.isHighlightable(s[t])&&t>=0)t--;return t;};e.exports=r;});
__d("legacy:ChatTypeaheadBehavior",["ChatTypeaheadBehavior"],function(a,b,c,d){var e=b('ChatTypeaheadBehavior');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.chatTypeahead=function(f){f.enableBehavior(e);};},3);
__d("ChatSidebarHeader.react",["React","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('cx'),i=g.createClass({displayName:'ReactChatSidebarHeader',render:function(){return (g.DOM.div({className:"_55ob"},g.DOM.div({className:"_55oc"},this.props.name)));}});e.exports=i;});
__d("ChatSidebarUser.react",["ChatFavoriteList","WebMessengerPermalinkConstants","ChatConfig","React","ChatSidebarItem.react"],function(a,b,c,d,e,f){var g=b('ChatFavoriteList'),h=b('WebMessengerPermalinkConstants'),i=b('ChatConfig'),j=b('React'),k=b('ChatSidebarItem.react'),l=j.createClass({displayName:'ChatSidebarUser',render:function(){var m=h.getURIPathForIDOrVanity(this.props.userID),n=g.isFavored(this.props.userID),o=function(){g.toggleID(this.props.userID);}.bind(this),p=i.get('divebar_favorite_list',0)?n:undefined;return (k({href:{url:m},imageSize:this.props.imageSize,images:this.props.image,litestandSidebar:this.props.litestandSidebar,isAdded:p,showEditButton:g.isEditMode(),name:this.props.name,onEditClick:o,status:this.props.status,birthday:this.props.birthday,statusTime:this.props.statusTime,context:this.props.context}));}});e.exports=l;});
__d("Dock",["function-extensions","Event","shield","WebMessengerWidthControl","Arbiter","ArbiterMixin","ChatQuietLinks","CSS","DataStore","DOM","Parent","Style","Toggler","Vector","copyProperties","csx","emptyFunction","ge"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Event'),h=b('shield');b('WebMessengerWidthControl');var i=b('Arbiter'),j=b('ArbiterMixin'),k=b('ChatQuietLinks'),l=b('CSS'),m=b('DataStore'),n=b('DOM'),o=b('Parent'),p=b('Style'),q=b('Toggler'),r=b('Vector'),s=b('copyProperties'),t=b('csx'),u=b('emptyFunction'),v=b('ge');function w(){}s(w,j,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(x){this.init=u;this.rootEl=x;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();k.removeEmptyHrefs(this.rootEl);g.listen(x,'click',this._onClick.bind(this));g.listen(window,'resize',this._onWindowResize.bind(this));q.subscribe(['show','hide'],function(y,z){var aa=z.getActive();if(!n.contains(x,aa))return;if(l.hasClass(aa,'fbNub')){this.notifyNub(aa,y);if(y==='show')this._resizeNubFlyout(aa);}else{var ba=o.byClass(aa,'fbNubFlyout');if(ba)l.conditionClass(ba,'menuOpened',y==='show');}}.bind(this));this.inform('init',{},i.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=r.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+r.getElementDimensions(this.rootEl).y;var x=v('blueBar');if(x){var y=p.isFixed(x)?'viewport':'document';this.flyoutHeightOffset+=r.getElementPosition(x,y).y+r.getElementDimensions(x).y;}},toggle:function(x){var y=this._findFlyout(x);if(!y)return;this.subscribe('init',function(){q.toggle(x);});},show:function(x){this.subscribe('init',function(){q.show(x);});},showNub:function(x){l.show(x);},hide:function(x){this.subscribe('init',function(){var y=q.getInstance(x);n.contains(x,y.getActive())&&y.hide();});},hideNub:function(x){l.hide(x);this.hide(x);},setUseMaxHeight:function(x,y){l.conditionClass(x,'maxHeight',y!==false);this._resizeNubFlyout(x);},_resizeNubFlyout:function(x){var y=this._findFlyout(x);if(!y||!(l.hasClass(x,'openToggler')||l.hasClass(x,'opened')))return;var z=n.find(y,'div.fbNubFlyoutOuter'),aa=n.find(z,'div.fbNubFlyoutInner'),ba=n.find(aa,'div.fbNubFlyoutBody'),ca=ba.scrollTop,da=ba.offsetHeight;p.set(ba,'height','auto');var ea=r.getElementDimensions(y),fa=r.getElementDimensions(ba),ga=this.getMaxFlyoutHeight(x);p.set(y,'max-height',ga+'px');p.set(z,'max-height',ga+'px');ea=r.getElementDimensions(y);var ha=r.getElementDimensions(aa),ia=ha.y-fa.y,ja=ea.y-ia,ka=parseInt(ba.style.height||ba.clientHeight,10),la=ja!==ka;if(ea.y>ia&&la)p.set(ba,'height',ja+'px');l.removeClass(y,'swapDirection');var ma=r.getElementPosition(y).x;l.conditionClass(y,'swapDirection',function(){if(ma<0)return true;return (ma+ea.x>this.viewportDimensions.x);}.bind(this)());if(la&&ca+da>=fa.y){ba.scrollTop=ba.scrollHeight;}else ba.scrollTop=ca;this.notifyNub(x,'resize');},getMaxFlyoutHeight:function(x){var y=this._findFlyout(x),z=r.getElementPosition(y,'viewport'),aa=r.getElementDimensions(y),ba=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-z.y-aa.y);return Math.max(ba,0);},resizeAllFlyouts:function(){var x=this._getAllNubs(),y=x.length;while(y--)this._resizeNubFlyout(x[y]);},hideAllFlyouts:function(){var x=this._getAllNubs(),y=x.length;while(y--)this.hide(x[y]);},_getAllNubs:function(){var x=n.scry(this.rootEl,"div._50-v.openToggler");return x.concat(n.scry(this.rootEl,"div._50-v.opened"));},_onClick:function(event){var x=event.getTarget(),y=o.byClass(x,'fbNub');if(y){if(o.byClass(x,'fbNubFlyoutTitlebar')){var z=o.byTag(x,'a'),aa=x.nodeName=='INPUT'&&x.getAttribute('type')=='submit';if(!z&&!aa){this.hide(y);return false;}}this.notifyNub(y,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(x){return l.hasClass(x,'fbNubFlyout')?x:n.scry(x,'div.fbNubFlyout')[0]||null;},registerNubController:function(x,y){m.set(x,'dock:nub:controller',y);y.subscribe('nub/button/content-changed',h(this.inform,this,'resize',x));y.subscribe('nub/flyout/content-changed',h(this._resizeNubFlyout,this,x));},unregisterNubController:function(x){m.remove(x,'dock:nub:controller');},notifyNub:function(x,y,z){var aa=m.get(x,'dock:nub:controller');aa&&aa.inform(y,z);}});e.exports=a.Dock||w;});